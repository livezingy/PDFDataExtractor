# streamlit_app/streamlit_app.py
# Streamlitåº”ç”¨ä¸»å…¥å£æ–‡ä»¶ï¼ˆç¤ºä¾‹ï¼‰
# æ³¨æ„ï¼šè¿™æ˜¯ç¤ºä¾‹æ–‡ä»¶ï¼Œå®é™…ä½¿ç”¨æ—¶è¯·æ ¹æ®é¡¹ç›®ç»“æ„è°ƒæ•´

import streamlit as st
import os
import tempfile
from pathlib import Path

# è®¾ç½®é¡µé¢é…ç½®
st.set_page_config(
    page_title="PDF Table Extractor",
    page_icon="ğŸ“Š",
    layout="wide",
    initial_sidebar_state="expanded"
)

# æ–‡ä»¶å¤§å°é™åˆ¶ï¼ˆ10MBï¼Œç”¨äºæµ‹è¯•å°æ–‡ä»¶ï¼‰
MAX_FILE_SIZE_MB = 10
MAX_FILE_SIZE = MAX_FILE_SIZE_MB * 1024 * 1024  # è½¬æ¢ä¸ºå­—èŠ‚

def check_file_size(file):
    """æ£€æŸ¥æ–‡ä»¶å¤§å°æ˜¯å¦ç¬¦åˆé™åˆ¶"""
    if file.size > MAX_FILE_SIZE:
        file_size_mb = file.size / 1024 / 1024
        st.error(
            f"âŒ æ–‡ä»¶è¿‡å¤§ ({file_size_mb:.2f} MB)\n\n"
            f"å½“å‰ç‰ˆæœ¬ä»…æ”¯æŒæµ‹è¯•å°æ–‡ä»¶ï¼ˆæœ€å¤§ {MAX_FILE_SIZE_MB} MBï¼‰\n\n"
            f"è¯·ä¸Šä¼ è¾ƒå°çš„PDFæ–‡ä»¶è¿›è¡Œæµ‹è¯•ã€‚"
        )
        return False
    return True

def main():
    st.title("ğŸ“Š PDF Table Extractor")
    st.markdown("---")
    
    # ä¾§è¾¹æ 
    with st.sidebar:
        st.header("ğŸ“ æ–‡ä»¶ä¸Šä¼ ")
        uploaded_file = st.file_uploader(
            "é€‰æ‹©PDFæ–‡ä»¶",
            type=["pdf"],
            help=f"ä»…æ”¯æŒPDFæ–‡ä»¶ï¼Œæœ€å¤§ {MAX_FILE_SIZE_MB} MB"
        )
        
        # æ˜¾ç¤ºæ–‡ä»¶å¤§å°é™åˆ¶æç¤º
        st.info(f"ğŸ’¡ **æµ‹è¯•ç‰ˆæœ¬é™åˆ¶**\n\næœ€å¤§æ–‡ä»¶å¤§å°: {MAX_FILE_SIZE_MB} MB")
        
        st.markdown("---")
        
        st.header("âš™ï¸ æå–é…ç½®")
        method = st.selectbox(
            "æå–æ–¹æ³•",
            ["PDFPlumber", "Camelot"],
            help="é€‰æ‹©è¡¨æ ¼æå–æ–¹æ³•"
        )
        
        if method == "PDFPlumber":
            flavor = st.selectbox(
                "Flavor",
                ["auto", "lines", "text"],
                help="PDFPlumberæå–æ¨¡å¼"
            )
        elif method == "Camelot":
            flavor = st.selectbox(
                "Flavor",
                ["auto", "lattice", "stream"],
                help="Camelotæå–æ¨¡å¼"
            )
        
        st.markdown("---")
        
        with st.expander("é«˜çº§é€‰é¡¹"):
            score_threshold = st.slider(
                "è¯„åˆ†é˜ˆå€¼",
                0.0, 1.0, 0.6,
                help="è¡¨æ ¼è¯„åˆ†é˜ˆå€¼ï¼Œä½äºæ­¤å€¼çš„è¡¨æ ¼å°†è¢«è¿‡æ»¤"
            )
        
        st.markdown("---")
        
        # æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯
        st.markdown("### ğŸ“š é¡¹ç›®ä¿¡æ¯")
        st.markdown("""
        - **GitHub**: [æŸ¥çœ‹æºç ](https://github.com/livezingy/PDFDataExtractor)
        - **æ–‡æ¡£**: [æŸ¥çœ‹æ–‡æ¡£](https://github.com/livezingy/PDFDataExtractor/tree/main/docs)
        """)
    
    # ä¸»ç•Œé¢
    if uploaded_file is not None:
        # æ£€æŸ¥æ–‡ä»¶å¤§å°
        if not check_file_size(uploaded_file):
            st.stop()
        
        # æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
        st.subheader("ğŸ“„ æ–‡ä»¶ä¿¡æ¯")
        col1, col2, col3 = st.columns(3)
        with col1:
            st.metric("æ–‡ä»¶å", uploaded_file.name)
        with col2:
            file_size_mb = uploaded_file.size / 1024 / 1024
            st.metric("æ–‡ä»¶å¤§å°", f"{file_size_mb:.2f} MB")
        with col3:
            st.metric("æ–‡ä»¶ç±»å‹", "PDF")
        
        st.markdown("---")
        
        # å¤„ç†æŒ‰é’®
        if st.button("ğŸš€ å¼€å§‹æå–", type="primary"):
            with st.spinner("æ­£åœ¨å¤„ç†PDFæ–‡ä»¶..."):
                # TODO: è°ƒç”¨å®é™…çš„å¤„ç†å‡½æ•°
                # results = process_pdf_streamlit(uploaded_file, method, flavor, {...})
                st.success("âœ… å¤„ç†å®Œæˆï¼")
                
                # æ˜¾ç¤ºç»“æœ
                st.subheader("ğŸ“Š æå–ç»“æœ")
                st.info("å¤„ç†åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...")
    else:
        # æ¬¢è¿ç•Œé¢
        st.info("ğŸ‘ˆ è¯·ä»å·¦ä¾§è¾¹æ ä¸Šä¼ PDFæ–‡ä»¶å¼€å§‹ä½¿ç”¨")
        
        st.markdown("""
        ## ğŸ¯ åŠŸèƒ½è¯´æ˜
        
        ### æ”¯æŒçš„æå–æ–¹æ³•
        
        - **PDFPlumber**: åŸºäºæ–‡æœ¬å’Œçº¿æ¡çš„å¯å‘å¼æå–
          - `lines`: é€‚ç”¨äºæœ‰æ¡†è¡¨æ ¼
          - `text`: é€‚ç”¨äºæ— æ¡†è¡¨æ ¼
          - `auto`: è‡ªåŠ¨é€‰æ‹©æœ€ä½³æ¨¡å¼
        
        - **Camelot**: åŸºäºæœºå™¨å­¦ä¹ çš„ç»“æ„æå–
          - `lattice`: é€‚ç”¨äºæœ‰æ¡†è¡¨æ ¼
          - `stream`: é€‚ç”¨äºæ— æ¡†è¡¨æ ¼
          - `auto`: è‡ªåŠ¨é€‰æ‹©æœ€ä½³æ¨¡å¼
        
        ### âš ï¸ æµ‹è¯•ç‰ˆæœ¬é™åˆ¶
        
        - å½“å‰ç‰ˆæœ¬ä»…æ”¯æŒæµ‹è¯•å°æ–‡ä»¶ï¼ˆæœ€å¤§ 10 MBï¼‰
        - éƒ¨åˆ†åŠŸèƒ½å¯èƒ½å—é™ï¼ˆå¦‚Camelotéœ€è¦ç³»ç»Ÿä¾èµ–ï¼‰
        - å»ºè®®ä½¿ç”¨å°å‹PDFæ–‡ä»¶è¿›è¡Œæµ‹è¯•
        """)

if __name__ == "__main__":
    main()

