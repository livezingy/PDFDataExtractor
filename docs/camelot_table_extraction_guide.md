# Camelot è¡¨æ ¼æå–æœºåˆ¶å®Œå…¨æŒ‡å—

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»Camelotåº“çš„è¡¨æ ¼æå–æœºåˆ¶ï¼ŒåŒ…æ‹¬Latticeå’ŒStreamä¸¤ç§æ¨¡å¼çš„å¤„ç†æµç¨‹ã€æ‰€æœ‰å‚æ•°çš„å®˜æ–¹å®šä¹‰ã€ä½œç”¨èŒƒå›´ä»¥åŠå‚æ•°è®¾å®šä¾æ®ã€‚

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**ç”Ÿæˆæ—¶é—´**: 2025-10-30  
**å‚è€ƒæ¥æº**: Camelotå®˜æ–¹æºä»£ç  (parsers/lattice.py, parsers/stream.py)

---

## ğŸ”„ Latticeæ¨¡å¼ - æœ‰æ¡†è¡¨æ ¼æå–

### 1. Latticeæ¨¡å¼å¤„ç†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è¾“å…¥: PDFæ–‡ä»¶å’Œé¡µé¢                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. PDFè½¬å›¾åƒ (ImageConversionBackend)                        â”‚
â”‚    - ä½¿ç”¨pdfium/poppler/ghostscriptåç«¯                      â”‚
â”‚    - é»˜è®¤åˆ†è¾¨ç‡: 300 DPI                                      â”‚
â”‚    - è¾“å‡ºPNGå›¾åƒ                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. è‡ªé€‚åº”é˜ˆå€¼å¤„ç† (adaptive_threshold)                       â”‚
â”‚    - OpenCVè‡ªé€‚åº”é˜ˆå€¼äºŒå€¼åŒ–                                   â”‚
â”‚    - blocksize: åƒç´ é‚»åŸŸå¤§å° (é»˜è®¤15)                        â”‚
â”‚    - constant: å‡å»çš„å¸¸æ•° (é»˜è®¤-2)                           â”‚
â”‚    - è¾“å‡º: äºŒå€¼åŒ–å›¾åƒ (é»‘ç™½)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. çº¿æ¡æ£€æµ‹ (find_lines)                                     â”‚
â”‚    - åº”ç”¨line_scaleå‚æ•°                                       â”‚
â”‚    - å‚ç›´çº¿æ£€æµ‹: åˆ›å»ºå‚ç›´kernelï¼Œå½¢æ€å­¦æ“ä½œ                  â”‚
â”‚      * kernel_size = image_height / line_scale               â”‚
â”‚      * è†¨èƒ€(dilate)æ“ä½œ iterations æ¬¡                        â”‚
â”‚      * æ£€æµ‹å‚ç›´çº¿æ¡                                           â”‚
â”‚    - æ°´å¹³çº¿æ£€æµ‹: åˆ›å»ºæ°´å¹³kernelï¼Œå½¢æ€å­¦æ“ä½œ                  â”‚
â”‚      * kernel_size = image_width / line_scale                â”‚
â”‚      * è†¨èƒ€(dilate)æ“ä½œ iterations æ¬¡                        â”‚
â”‚      * æ£€æµ‹æ°´å¹³çº¿æ¡                                           â”‚
â”‚    - è¾“å‡º: vertical_segments, horizontal_segments            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. è½®å»“æ£€æµ‹å’Œäº¤ç‚¹æŸ¥æ‰¾ (find_contours & find_joints)          â”‚
â”‚    - åˆå¹¶å‚ç›´å’Œæ°´å¹³mask                                       â”‚
â”‚    - æŸ¥æ‰¾è½®å»“ (OpenCV findContours)                          â”‚
â”‚    - è¯†åˆ«çº¿æ¡äº¤ç‚¹ (joints)                                    â”‚
â”‚    - ç”Ÿæˆè¡¨æ ¼å€™é€‰åŒºåŸŸè¾¹ç•Œæ¡† (bbox)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. åæ ‡ç¼©æ”¾ (scale_image)                                    â”‚
â”‚    - å°†å›¾åƒåæ ‡è½¬æ¢å›PDFåæ ‡ç³»ç»Ÿ                              â”‚
â”‚    - åº”ç”¨ç¼©æ”¾å› å­                                             â”‚
â”‚    - ä¿æŒPDFåŸå§‹åæ ‡ç²¾åº¦                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. åº”ç”¨line_tol - åˆå¹¶æ¥è¿‘çš„çº¿æ¡åæ ‡                         â”‚
â”‚    - åˆå¹¶æ¥è¿‘çš„Xåæ ‡ (åˆ—è¾¹ç•Œ)                                 â”‚
â”‚      * å¦‚æœ |x_left - x_right| <= line_tol â†’ åˆå¹¶            â”‚
â”‚    - åˆå¹¶æ¥è¿‘çš„Yåæ ‡ (è¡Œè¾¹ç•Œ)                                 â”‚
â”‚      * å¦‚æœ |y_bottom - y_top| <= line_tol â†’ åˆå¹¶            â”‚
â”‚    - è¾“å‡º: col_anchors (åˆ—é”šç‚¹), row_anchors (è¡Œé”šç‚¹)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. ç”Ÿæˆåˆ—å’Œè¡Œ (_generate_columns_and_rows)                   â”‚
â”‚    - æ ¹æ®é”šç‚¹åˆ›å»ºåˆ—è¾¹ç•Œå¯¹: (x_left, x_right)                 â”‚
â”‚    - æ ¹æ®é”šç‚¹åˆ›å»ºè¡Œè¾¹ç•Œå¯¹: (y_bottom, y_top)                 â”‚
â”‚    - é€‰æ‹©bboxå†…çš„çº¿æ®µ                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. ç”Ÿæˆè¡¨æ ¼å¯¹è±¡ (_generate_table)                            â”‚
â”‚    - åˆ›å»ºTableå¯¹è±¡ (cols Ã— rows ç½‘æ ¼)                        â”‚
â”‚    - åº”ç”¨joint_tol - è®¾ç½®å•å…ƒæ ¼è¾¹ç¼˜                          â”‚
â”‚      * æ£€æŸ¥å‚ç›´/æ°´å¹³çº¿æ®µæ˜¯å¦åœ¨joint_tolå†…ç›¸äº¤                â”‚
â”‚      * è®¾ç½®å•å…ƒæ ¼çš„è¾¹ç¼˜å±æ€§ (left, right, top, bottom)       â”‚
â”‚    - è®¾ç½®è¡¨æ ¼è¾¹æ¡† (set_border)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. æ–‡æœ¬æå–å’Œåˆ†é…                                            â”‚
â”‚    - æå–PDFä¸­çš„æ–‡æœ¬å¯¹è±¡                                      â”‚
â”‚    - æ ¹æ®æ–‡æœ¬bboxå°†æ–‡æœ¬åˆ†é…åˆ°å¯¹åº”å•å…ƒæ ¼                       â”‚
â”‚    - åº”ç”¨shift_text: å¤„ç†è·¨å•å…ƒæ ¼æ–‡æœ¬                        â”‚
â”‚      * 'l': å‘å·¦ç§»åŠ¨åˆ°æœ‰å·¦è¾¹ç•Œçš„å•å…ƒæ ¼                       â”‚
â”‚      * 'r': å‘å³ç§»åŠ¨åˆ°æœ‰å³è¾¹ç•Œçš„å•å…ƒæ ¼                       â”‚
â”‚      * 't': å‘ä¸Šç§»åŠ¨åˆ°æœ‰ä¸Šè¾¹ç•Œçš„å•å…ƒæ ¼                       â”‚
â”‚      * 'b': å‘ä¸‹ç§»åŠ¨åˆ°æœ‰ä¸‹è¾¹ç•Œçš„å•å…ƒæ ¼                       â”‚
â”‚    - åº”ç”¨copy_text: å¤åˆ¶æ–‡æœ¬åˆ°ç›¸é‚»å•å…ƒæ ¼                     â”‚
â”‚    - åº”ç”¨split_text: åˆ†å‰²è·¨å•å…ƒæ ¼æ–‡æœ¬                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 11. è¾“å‡º: Tableå¯¹è±¡åˆ—è¡¨                                       â”‚
â”‚     - åŒ…å«å•å…ƒæ ¼ç½‘æ ¼ã€æ–‡æœ¬å†…å®¹ã€è¾¹ç•Œæ¡†ç­‰                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. Latticeæ¨¡å¼å‚æ•°è¯¦ç»†è¯´æ˜

#### å‚æ•° 1: line_scale

**å®˜æ–¹å®šä¹‰**:
> Line size scaling factor. The larger the value the smaller the detected lines. Making it very large will lead to text being detected as lines.

**ä¸­æ–‡ç¿»è¯‘**:
çº¿æ¡å¤§å°ç¼©æ”¾å› å­ã€‚å€¼è¶Šå¤§ï¼Œæ£€æµ‹åˆ°çš„çº¿æ¡è¶Šç»†ã€‚è®¾ç½®è¿‡å¤§ä¼šå¯¼è‡´æ–‡æœ¬è¢«è¯¯æ£€æµ‹ä¸ºçº¿æ¡ã€‚

**ä½œç”¨**:
- æ§åˆ¶æ£€æµ‹çº¿æ¡çš„ç²—ç»†é˜ˆå€¼
- å½±å“å½¢æ€å­¦kernelçš„å¤§å°
- å†³å®šå“ªäº›åƒç´ æ¨¡å¼è¢«è¯†åˆ«ä¸ºçº¿æ¡

**å·¥ä½œåŸç†**:
```python
# æºä»£ç å®ç° (image_processing.py: find_lines)
def find_lines(threshold, direction='vertical', line_scale=15):
    """
    æ£€æµ‹çº¿æ¡çš„kernelå¤§å°è®¡ç®—:
    
    å‚ç›´çº¿:
        kernel_length = image_height / line_scale
        kernel = np.ones((kernel_length, 1), np.uint8)
    
    æ°´å¹³çº¿:
        kernel_length = image_width / line_scale
        kernel = np.ones((1, kernel_length), np.uint8)
    
    line_scaleè¶Šå¤§ â†’ kernel_lengthè¶Šå° â†’ æ£€æµ‹æ›´ç»†çš„çº¿
    line_scaleè¶Šå° â†’ kernel_lengthè¶Šå¤§ â†’ æ£€æµ‹æ›´ç²—çš„çº¿
    """
```

**ç¤ºä¾‹**:
```python
# åœºæ™¯ï¼š600åƒç´ é«˜çš„å›¾åƒ
å›¾åƒé«˜åº¦ = 600px

line_scale = 15:
    kernel_length = 600 / 15 = 40px
    â†’ æ£€æµ‹è‡³å°‘40pxé•¿çš„å‚ç›´æ¨¡å¼
    â†’ é€‚åˆæ ‡å‡†çº¿æ¡

line_scale = 40:
    kernel_length = 600 / 40 = 15px
    â†’ æ£€æµ‹è‡³å°‘15pxé•¿çš„å‚ç›´æ¨¡å¼
    â†’ æ£€æµ‹æ›´ç»†çš„çº¿æ¡
    â†’ å¯èƒ½è¯¯æ£€æµ‹æ–‡æœ¬ä¸ºçº¿æ¡ âš ï¸

line_scale = 10:
    kernel_length = 600 / 10 = 60px
    â†’ æ£€æµ‹è‡³å°‘60pxé•¿çš„å‚ç›´æ¨¡å¼
    â†’ åªæ£€æµ‹ç²—çº¿æ¡
    â†’ å¯èƒ½é—æ¼ç»†çº¿æ¡ âš ï¸
```

**å½±å“èŒƒå›´**:
- â­â­â­â­â­ çº¿æ¡æ£€æµ‹çµæ•åº¦
- â­â­â­â­â­ è¡¨æ ¼è¯†åˆ«æˆåŠŸç‡
- â­â­â­â­ å™ªå£°æŠ‘åˆ¶
- âš ï¸ **é£é™©**: è¿‡å¤§ä¼šè¯¯æ£€æµ‹æ–‡æœ¬ï¼Œè¿‡å°ä¼šé—æ¼ç»†çº¿

**ç†è®ºè®¾å®šèŒƒå›´**: 10 ~ 100
- **10-20**: æ£€æµ‹ç²—çº¿æ¡ï¼Œé€‚åˆä½åˆ†è¾¨ç‡æˆ–ç²—è¾¹æ¡†è¡¨æ ¼
- **15-40**: æ ‡å‡†èŒƒå›´ï¼Œé€‚åˆå¤§å¤šæ•°è¡¨æ ¼
- **40-100**: æ£€æµ‹ç»†çº¿æ¡ï¼Œé€‚åˆé«˜åˆ†è¾¨ç‡PDF

**å¯ç”¨äºè®¾å®šçš„PDFé¡µé¢å±æ€§**:

| PDFå±æ€§ | è®¡ç®—å…¬å¼ | è¯´æ˜ |
|---------|----------|------|
| å›¾åƒå°ºå¯¸ (æ ‡å‡†) | `min(image_height, image_width) * 0.01` | åŸºäºå›¾åƒå¤§å°è‡ªé€‚åº” |
| çº¿æ¡å¹³å‡å®½åº¦ | `image_size / (avg_line_width * 2)` | åŸºäºçº¿æ¡å®é™…å®½åº¦ |
| åˆ†è¾¨ç‡ | 150dpi â†’ 20-25 | ä½åˆ†è¾¨ç‡ç”¨è¾ƒå°å€¼ |
| åˆ†è¾¨ç‡ | 300dpi â†’ 15-40 | æ ‡å‡†åˆ†è¾¨ç‡ |
| åˆ†è¾¨ç‡ | 600dpi â†’ 40-60 | é«˜åˆ†è¾¨ç‡ç”¨è¾ƒå¤§å€¼ |
| çº¿æ¡å¯†åº¦ | é«˜å¯†åº¦ â†’ å¢å¤§ (30-50) | é¿å…ç²—çº¿æ¡åˆå¹¶ |
| çº¿æ¡å¯†åº¦ | ä½å¯†åº¦ â†’ å‡å° (10-20) | å¢å¼ºæ£€æµ‹çµæ•åº¦ |
| çº¿æ¡è´¨é‡ | æ¨¡ç³Š/æ–­è£‚ â†’ å‡å° (10-15) | æ£€æµ‹æ›´å®½èŒƒå›´ |
| çº¿æ¡è´¨é‡ | æ¸…æ™° â†’ å¢å¤§ (25-40) | ç²¾ç¡®æ£€æµ‹ |

**æ¨èè®¾ç½®é€»è¾‘**:
```python
# åŸºäºå›¾åƒå°ºå¯¸è‡ªé€‚åº”
if image_shape:
    line_scale = min(40, max(15, int(min(image_shape) * 0.01)))
else:
    line_scale = 15  # é»˜è®¤å€¼
```

---

#### å‚æ•° 2: line_tol

**å®˜æ–¹å®šä¹‰**:
> Tolerance parameter used to merge close vertical and horizontal lines.

**ä¸­æ–‡ç¿»è¯‘**:
ç”¨äºåˆå¹¶æ¥è¿‘çš„å‚ç›´å’Œæ°´å¹³çº¿çš„å®¹å·®å‚æ•°ã€‚

**ä½œç”¨**:
- åˆå¹¶ä½ç½®æ¥è¿‘çš„å¹³è¡Œçº¿
- æ¶ˆé™¤çº¿æ¡æ£€æµ‹çš„å¾®å°åå·®
- ç®€åŒ–è¡¨æ ¼ç»“æ„

**å·¥ä½œåŸç†**:
```python
# æºä»£ç å®ç° (lattice.py: _generate_table_bbox)
def merge_close_lines(coords, line_tol=2):
    """
    åˆå¹¶æ¥è¿‘çš„åæ ‡:
    
    å¯¹äºXåæ ‡ (åˆ—è¾¹ç•Œ):
        å¦‚æœ x_left - line_tol <= x_right <= x_left + line_tol:
            â†’ x_right = x_left (åˆå¹¶åˆ°åŒä¸€ä½ç½®)
    
    å¯¹äºYåæ ‡ (è¡Œè¾¹ç•Œ):
        å¦‚æœ y_bottom - line_tol <= y_top <= y_bottom + line_tol:
            â†’ y_top = y_bottom (åˆå¹¶åˆ°åŒä¸€ä½ç½®)
    """
```

**ç¤ºä¾‹**:
```python
# åœºæ™¯ï¼šæ£€æµ‹åˆ°çš„åˆ—è¾¹ç•ŒXåæ ‡
æ£€æµ‹åˆ°çš„Xåæ ‡:
  x1 = 100.0
  x2 = 100.5  # åå·®0.5pt
  x3 = 101.8  # åå·®1.8pt
  x4 = 105.0  # åå·®5.0pt

line_tol = 2:
  â†’ x1, x2, x3 åˆå¹¶åˆ° 100.0 (éƒ½åœ¨å®¹å·®å†…)
  â†’ x4 ä¿æŒç‹¬ç«‹ (è¶…å‡ºå®¹å·®)
  â†’ è¯†åˆ«ä¸º2åˆ— âœ…

line_tol = 0.5:
  â†’ x1, x2 åˆå¹¶åˆ° 100.0
  â†’ x3 ä¿æŒç‹¬ç«‹
  â†’ x4 ä¿æŒç‹¬ç«‹
  â†’ è¯†åˆ«ä¸º3åˆ— (å¯èƒ½è¿‡äºæ•æ„Ÿ)

line_tol = 6:
  â†’ å…¨éƒ¨åˆå¹¶åˆ° 100.0
  â†’ è¯†åˆ«ä¸º1åˆ— âŒ (é”™è¯¯åˆå¹¶)
```

**å½±å“èŒƒå›´**:
- â­â­â­â­ åˆ—è¡Œæ•°é‡å‡†ç¡®æ€§
- â­â­â­â­ è¡¨æ ¼ç»“æ„ç®€åŒ–
- â­â­â­ å®¹é”™èƒ½åŠ›
- âš ï¸ **é£é™©**: è¿‡å¤§ä¼šé”™è¯¯åˆå¹¶ä¸åŒçš„åˆ—/è¡Œ

**ç†è®ºè®¾å®šèŒƒå›´**: 0 ~ 10 ç‚¹
- **0-1**: ä¸¥æ ¼æ¨¡å¼ï¼Œä¸åˆå¹¶
- **2-3**: æ ‡å‡†èŒƒå›´ï¼Œåˆå¹¶å¾®å°åå·®
- **4-10**: å®½æ¾æ¨¡å¼ï¼Œå®¹å¿è¾ƒå¤§åå·®

**å¯ç”¨äºè®¾å®šçš„PDFé¡µé¢å±æ€§**:

| PDFå±æ€§ | è®¡ç®—å…¬å¼ | è¯´æ˜ |
|---------|----------|------|
| çº¿æ¡ä½ç½®æ ‡å‡†å·® | `line_position_std * 2~3` | è¦†ç›–2-3å€æ ‡å‡†å·® |
| æœ€å°åˆ—é—´è· | `min_column_spacing * 0.05~0.1` | é—´è·çš„5-10% |
| å­—ç¬¦å¹³å‡å®½åº¦ | `avg_char_width * 0.3~0.5` | åŸºäºæ–‡æœ¬å°ºå¯¸ |
| PDFè´¨é‡ | æ‰«æPDF â†’ 3~5 | å®¹å¿æ›´å¤§åå·® |
| PDFè´¨é‡ | åŸç”ŸPDF â†’ 1~2 | ç²¾ç¡®å¯¹é½ |
| çº¿æ¡æŠ–åŠ¨ | é«˜æŠ–åŠ¨ â†’ 4~6 | åˆå¹¶æŠ–åŠ¨çº¿æ¡ |
| çº¿æ¡æŠ–åŠ¨ | ä½æŠ–åŠ¨ â†’ 1~2 | ä¿æŒç²¾ç¡® |

**æ¨èå€¼**: 2 (é»˜è®¤å€¼ï¼Œé€‚åˆå¤§å¤šæ•°æƒ…å†µ)

---

#### å‚æ•° 3: joint_tol

**å®˜æ–¹å®šä¹‰**:
> Tolerance parameter used to decide whether the detected lines and points lie close to each other.

**ä¸­æ–‡ç¿»è¯‘**:
ç”¨äºåˆ¤å®šæ£€æµ‹åˆ°çš„çº¿æ¡å’Œäº¤ç‚¹æ˜¯å¦å½¼æ­¤æ¥è¿‘çš„å®¹å·®å‚æ•°ã€‚

**ä½œç”¨**:
- åˆ¤æ–­çº¿æ®µæ˜¯å¦åœ¨äº¤ç‚¹é™„è¿‘
- å†³å®šå•å…ƒæ ¼è¾¹ç¼˜çš„è®¾ç½®
- å½±å“è¡¨æ ¼å•å…ƒæ ¼è¾¹ç•Œè¯†åˆ«

**å·¥ä½œåŸç†**:
```python
# æºä»£ç å®ç° (lattice.py: _generate_table & core.py: set_edges)
def set_edges(vertical_segments, horizontal_segments, joint_tol=2):
    """
    ä¸ºæ¯ä¸ªå•å…ƒæ ¼è®¾ç½®è¾¹ç¼˜:
    
    å¯¹äºå•å…ƒæ ¼ (row_idx, col_idx):
        å·¦è¾¹ç¼˜: æ£€æŸ¥æ˜¯å¦æœ‰å‚ç›´çº¿æ®µåœ¨ (x_left Â± joint_tol) èŒƒå›´å†…
        å³è¾¹ç¼˜: æ£€æŸ¥æ˜¯å¦æœ‰å‚ç›´çº¿æ®µåœ¨ (x_right Â± joint_tol) èŒƒå›´å†…
        ä¸Šè¾¹ç¼˜: æ£€æŸ¥æ˜¯å¦æœ‰æ°´å¹³çº¿æ®µåœ¨ (y_top Â± joint_tol) èŒƒå›´å†…
        ä¸‹è¾¹ç¼˜: æ£€æŸ¥æ˜¯å¦æœ‰æ°´å¹³çº¿æ®µåœ¨ (y_bottom Â± joint_tol) èŒƒå›´å†…
    
    å¦‚æœçº¿æ®µåœ¨å®¹å·®èŒƒå›´å†… â†’ è®¾ç½®è¯¥è¾¹ç¼˜ä¸ºTrue
    å¦åˆ™ â†’ è¯¥è¾¹ç¼˜ä¸ºFalse (è·¨å•å…ƒæ ¼)
    """
```

**ç¤ºä¾‹**:
```python
# åœºæ™¯ï¼šæ£€æŸ¥å•å…ƒæ ¼æ˜¯å¦æœ‰å·¦è¾¹ç¼˜
å•å…ƒæ ¼å·¦è¾¹ç•Œ x = 100.0
æ£€æµ‹åˆ°çš„å‚ç›´çº¿æ®µ:
  segment1: x = 100.5  # åå·®0.5pt
  segment2: x = 98.0   # åå·®2.0pt
  segment3: x = 96.0   # åå·®4.0pt

joint_tol = 2:
  â†’ segment1: |100.5 - 100.0| = 0.5 <= 2 â†’ è®¾ç½®å·¦è¾¹ç¼˜ âœ…
  â†’ segment2: |98.0 - 100.0| = 2.0 <= 2 â†’ è®¾ç½®å·¦è¾¹ç¼˜ âœ…
  â†’ segment3: |96.0 - 100.0| = 4.0 > 2 â†’ ä¸è®¾ç½® âŒ

joint_tol = 1:
  â†’ segment1: è®¾ç½® âœ…
  â†’ segment2: ä¸è®¾ç½® âŒ
  â†’ segment3: ä¸è®¾ç½® âŒ
  â†’ å¯èƒ½è¯¯è¯†åˆ«ä¸ºè·¨å•å…ƒæ ¼

joint_tol = 5:
  â†’ å…¨éƒ¨è®¾ç½® âœ…
  â†’ å¯èƒ½è®¾ç½®è¿‡å¤šè¾¹ç¼˜
```

**å½±å“èŒƒå›´**:
- â­â­â­â­â­ å•å…ƒæ ¼è¾¹ç¼˜è¯†åˆ«
- â­â­â­â­â­ è·¨å•å…ƒæ ¼æ£€æµ‹
- â­â­â­â­ æ–‡æœ¬åˆ†é…å‡†ç¡®æ€§
- âš ï¸ **é£é™©**: è¿‡å¤§ä¼šé”™è¯¯è®¾ç½®è¾¹ç¼˜ï¼Œè¿‡å°ä¼šé—æ¼çœŸå®è¾¹ç¼˜

**ç†è®ºè®¾å®šèŒƒå›´**: 0 ~ 10 ç‚¹
- **0-1**: ä¸¥æ ¼æ¨¡å¼ï¼Œè¦æ±‚ç²¾ç¡®å¯¹é½
- **2-3**: æ ‡å‡†èŒƒå›´ï¼Œå®¹å¿å¾®å°åå·®
- **4-10**: å®½æ¾æ¨¡å¼ï¼Œå®¹å¿è¾ƒå¤§åå·®

**å¯ç”¨äºè®¾å®šçš„PDFé¡µé¢å±æ€§**:

| PDFå±æ€§ | è®¡ç®—å…¬å¼ | è¯´æ˜ |
|---------|----------|------|
| çº¿æ¡å¯¹é½ç²¾åº¦ | `line_alignment_std * 2~3` | åŸºäºå¯¹é½æ ‡å‡†å·® |
| line_tol | `line_tol * 1.0~1.5` | ä¸line_tolä¿æŒä¸€è‡´ |
| å­—ç¬¦å¹³å‡å®½åº¦ | `avg_char_width * 0.3~0.5` | åŸºäºæ–‡æœ¬å°ºå¯¸ |
| PDFè´¨é‡ | æ‰«æPDF â†’ 3~5 | å®¹å¿æ›´å¤§åå·® |
| PDFè´¨é‡ | åŸç”ŸPDF â†’ 1~2 | ç²¾ç¡®å¯¹é½ |
| æ¸²æŸ“è´¨é‡ | ä½è´¨é‡ â†’ 4~6 | è¡¥å¿æ¸²æŸ“è¯¯å·® |

**æ¨èå€¼**: 2 (é»˜è®¤å€¼ï¼Œé€šå¸¸ä¸line_tolä¿æŒä¸€è‡´)

---

#### å‚æ•° 4: threshold_blocksize

**å®˜æ–¹å®šä¹‰**:
> Size of a pixel neighborhood that is used to calculate a threshold value for the pixel: 3, 5, 7, and so on.

**ä¸­æ–‡ç¿»è¯‘**:
ç”¨äºè®¡ç®—åƒç´ é˜ˆå€¼çš„åƒç´ é‚»åŸŸå¤§å°ï¼š3ã€5ã€7ç­‰ï¼ˆå¿…é¡»ä¸ºå¥‡æ•°ï¼‰ã€‚

**ä½œç”¨**:
- æ§åˆ¶è‡ªé€‚åº”é˜ˆå€¼çš„å±€éƒ¨æ€§
- å½±å“äºŒå€¼åŒ–æ•ˆæœ
- é€‚åº”ä¸åŒçš„å…‰ç…§å’Œå¯¹æ¯”åº¦

**å·¥ä½œåŸç†**:
```python
# OpenCV adaptiveThresholdå®ç°
cv2.adaptiveThreshold(
    src,                    # è¾“å…¥å›¾åƒ
    maxValue=255,           # æœ€å¤§å€¼
    adaptiveMethod=cv2.ADAPTIVE_THRESH_GAUSSIAN_C,
    thresholdType=cv2.THRESH_BINARY,
    blockSize=blocksize,    # é‚»åŸŸå¤§å° â† æ­¤å‚æ•°
    C=constant              # å‡å»çš„å¸¸æ•°
)

"""
blocksizeè¶Šå¤§:
  â†’ è€ƒè™‘æ›´å¤§çš„é‚»åŸŸ
  â†’ é˜ˆå€¼å˜åŒ–æ›´å¹³æ»‘
  â†’ é€‚åˆæ¸å˜èƒŒæ™¯

blocksizeè¶Šå°:
  â†’ è€ƒè™‘æ›´å°çš„é‚»åŸŸ
  â†’ é˜ˆå€¼å˜åŒ–æ›´æ•æ„Ÿ
  â†’ é€‚åˆå±€éƒ¨å¯¹æ¯”åº¦å˜åŒ–å¤§çš„å›¾åƒ
"""
```

**ç¤ºä¾‹**:
```python
# åœºæ™¯ï¼šå¤„ç†æ‰«æPDF
PDFç‰¹å¾: èƒŒæ™¯ä¸å‡åŒ€ï¼Œæœ‰é˜´å½±

blocksize = 15 (é»˜è®¤):
  â†’ è€ƒè™‘15Ã—15åƒç´ é‚»åŸŸ
  â†’ é€‚åˆä¸€èˆ¬è¡¨æ ¼ âœ…

blocksize = 5:
  â†’ è€ƒè™‘5Ã—5åƒç´ é‚»åŸŸ
  â†’ å¯¹å±€éƒ¨å˜åŒ–æ•æ„Ÿ
  â†’ å¯èƒ½äº§ç”Ÿè¿‡å¤šå™ªç‚¹ âš ï¸

blocksize = 31:
  â†’ è€ƒè™‘31Ã—31åƒç´ é‚»åŸŸ
  â†’ é˜ˆå€¼å¹³æ»‘
  â†’ å¯èƒ½ä¸¢å¤±ç»†èŠ‚ âš ï¸
```

**å½±å“èŒƒå›´**:
- â­â­â­â­ äºŒå€¼åŒ–è´¨é‡
- â­â­â­ çº¿æ¡æ£€æµ‹å‡†ç¡®æ€§
- â­â­â­ å™ªå£°æŠ‘åˆ¶
- âš ï¸ **é£é™©**: è®¾ç½®ä¸å½“ä¼šå½±å“çº¿æ¡æ£€æµ‹

**ç†è®ºè®¾å®šèŒƒå›´**: 3 ~ 51 (å¿…é¡»ä¸ºå¥‡æ•°)
- **3-11**: å°é‚»åŸŸï¼Œé€‚åˆå±€éƒ¨å¯¹æ¯”åº¦é«˜
- **11-21**: ä¸­ç­‰é‚»åŸŸï¼Œæ ‡å‡†èŒƒå›´
- **21-51**: å¤§é‚»åŸŸï¼Œé€‚åˆèƒŒæ™¯ä¸å‡åŒ€

**å¯ç”¨äºè®¾å®šçš„PDFé¡µé¢å±æ€§**:

| PDFå±æ€§ | æ¨èå€¼ | è¯´æ˜ |
|---------|--------|------|
| PDFç±»å‹ | åŸç”ŸPDF â†’ 11-15 | èƒŒæ™¯å‡åŒ€ |
| PDFç±»å‹ | æ‰«æPDF â†’ 15-25 | èƒŒæ™¯å¯èƒ½ä¸å‡ |
| èƒŒæ™¯è´¨é‡ | å‡åŒ€èƒŒæ™¯ â†’ 11-15 | å°é‚»åŸŸå³å¯ |
| èƒŒæ™¯è´¨é‡ | æ¸å˜èƒŒæ™¯ â†’ 21-31 | éœ€è¦å¤§é‚»åŸŸ |
| å™ªå£°æ°´å¹³ | ä½å™ªå£° â†’ 11-15 | æ•æ„Ÿæ£€æµ‹ |
| å™ªå£°æ°´å¹³ | é«˜å™ªå£° â†’ 21-31 | å¹³æ»‘å¤„ç† |
| åˆ†è¾¨ç‡ | ä½åˆ†è¾¨ç‡ â†’ 11-15 | é¿å…è¿‡åº¦å¹³æ»‘ |
| åˆ†è¾¨ç‡ | é«˜åˆ†è¾¨ç‡ â†’ 15-25 | å¯ç”¨å¤§é‚»åŸŸ |

**æ¨èå€¼**: 15 (é»˜è®¤å€¼ï¼Œé€‚åˆå¤§å¤šæ•°æƒ…å†µ)

---

#### å‚æ•° 5: threshold_constant

**å®˜æ–¹å®šä¹‰**:
> Constant subtracted from the mean or weighted mean. Normally, it is positive but may be zero or negative as well.

**ä¸­æ–‡ç¿»è¯‘**:
ä»å‡å€¼æˆ–åŠ æƒå‡å€¼ä¸­å‡å»çš„å¸¸æ•°ã€‚é€šå¸¸ä¸ºæ­£å€¼ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯é›¶æˆ–è´Ÿå€¼ã€‚

**ä½œç”¨**:
- å¾®è°ƒäºŒå€¼åŒ–é˜ˆå€¼
- æ§åˆ¶çº¿æ¡æ£€æµ‹çš„çµæ•åº¦
- é€‚åº”ä¸åŒçš„å¯¹æ¯”åº¦

**å·¥ä½œåŸç†**:
```python
# è‡ªé€‚åº”é˜ˆå€¼è®¡ç®—
threshold = local_mean - constant

"""
constant = -2 (é»˜è®¤):
  â†’ threshold = local_mean - (-2) = local_mean + 2
  â†’ é˜ˆå€¼æé«˜ï¼Œæ›´å¤šåƒç´ è¢«è¯†åˆ«ä¸ºç™½è‰²
  â†’ çº¿æ¡æ›´ç»†ï¼ŒèƒŒæ™¯æ›´å¹²å‡€

constant = 0:
  â†’ threshold = local_mean
  â†’ æ ‡å‡†é˜ˆå€¼

constant = -5:
  â†’ threshold = local_mean + 5
  â†’ é˜ˆå€¼æ›´é«˜ï¼Œçº¿æ¡æ›´ç»†
  â†’ å¯èƒ½ä¸¢å¤±ç»†çº¿æ¡ âš ï¸

constant = 2:
  â†’ threshold = local_mean - 2
  â†’ é˜ˆå€¼é™ä½ï¼Œæ›´å¤šåƒç´ è¢«è¯†åˆ«ä¸ºé»‘è‰²
  â†’ çº¿æ¡æ›´ç²—ï¼Œå¯èƒ½æœ‰å™ªç‚¹ âš ï¸
"""
```

**ç¤ºä¾‹**:
```python
# åœºæ™¯ï¼šè°ƒæ•´çº¿æ¡æ£€æµ‹çµæ•åº¦
PDFç‰¹å¾: çº¿æ¡è¾ƒæ·¡

threshold_constant = -2 (é»˜è®¤):
  â†’ æ ‡å‡†æ£€æµ‹
  â†’ æ·¡çº¿æ¡å¯èƒ½æ£€æµ‹ä¸åˆ° âš ï¸

threshold_constant = 2:
  â†’ é™ä½é˜ˆå€¼ï¼Œå¢å¼ºæ£€æµ‹
  â†’ æ·¡çº¿æ¡å¯ä»¥æ£€æµ‹åˆ° âœ…
  â†’ ä½†å¯èƒ½å¼•å…¥å™ªç‚¹ âš ï¸

threshold_constant = -5:
  â†’ æé«˜é˜ˆå€¼ï¼Œå‡å¼±æ£€æµ‹
  â†’ åªæ£€æµ‹æ·±è‰²çº¿æ¡
  â†’ æ·¡çº¿æ¡å®Œå…¨ä¸¢å¤± âŒ
```

**å½±å“èŒƒå›´**:
- â­â­â­â­ çº¿æ¡æ£€æµ‹çµæ•åº¦
- â­â­â­ å™ªå£°æ°´å¹³
- â­â­â­ ç»†çº¿æ¡æ£€æµ‹
- âš ï¸ **é£é™©**: è°ƒæ•´ä¸å½“ä¼šé—æ¼çº¿æ¡æˆ–å¼•å…¥å™ªç‚¹

**ç†è®ºè®¾å®šèŒƒå›´**: -10 ~ 10
- **-10 ~ -5**: é«˜é˜ˆå€¼ï¼Œåªæ£€æµ‹æ·±è‰²ç²—çº¿
- **-5 ~ 0**: æ ‡å‡†èŒƒå›´
- **0 ~ 5**: ä½é˜ˆå€¼ï¼Œæ£€æµ‹æ·¡è‰²ç»†çº¿
- **5 ~ 10**: å¾ˆä½é˜ˆå€¼ï¼Œå¯èƒ½å¼•å…¥å¤§é‡å™ªç‚¹

**å¯ç”¨äºè®¾å®šçš„PDFé¡µé¢å±æ€§**:

| PDFå±æ€§ | æ¨èå€¼ | è¯´æ˜ |
|---------|--------|------|
| çº¿æ¡é¢œè‰² | æ·±è‰²çº¿ â†’ -5 ~ -2 | æ ‡å‡†é˜ˆå€¼ |
| çº¿æ¡é¢œè‰² | æ·¡è‰²çº¿ â†’ 0 ~ 5 | é™ä½é˜ˆå€¼å¢å¼ºæ£€æµ‹ |
| å¯¹æ¯”åº¦ | é«˜å¯¹æ¯”åº¦ â†’ -5 ~ -2 | æ ‡å‡†å¤„ç† |
| å¯¹æ¯”åº¦ | ä½å¯¹æ¯”åº¦ â†’ -1 ~ 3 | é™ä½é˜ˆå€¼ |
| èƒŒæ™¯ | çº¯ç™½èƒŒæ™¯ â†’ -5 ~ -2 | æ ‡å‡†å¤„ç† |
| èƒŒæ™¯ | ç°è‰²èƒŒæ™¯ â†’ 0 ~ 5 | é™ä½é˜ˆå€¼ |
| å™ªå£° | ä½å™ªå£° â†’ 0 ~ 5 | å¯é™ä½é˜ˆå€¼ |
| å™ªå£° | é«˜å™ªå£° â†’ -5 ~ -2 | æé«˜é˜ˆå€¼æŠ‘åˆ¶å™ªå£° |

**æ¨èå€¼**: -2 (é»˜è®¤å€¼)

---

#### å‚æ•° 6: iterations

**å®˜æ–¹å®šä¹‰**:
> Number of times for erosion/dilation is applied.

**ä¸­æ–‡ç¿»è¯‘**:
è…èš€/è†¨èƒ€æ“ä½œåº”ç”¨çš„æ¬¡æ•°ã€‚

**ä½œç”¨**:
- å¢å¼ºçº¿æ¡è¿ç»­æ€§
- å¡«è¡¥çº¿æ¡æ–­è£‚
- å»é™¤å°å™ªç‚¹

**å·¥ä½œåŸç†**:
```python
# å½¢æ€å­¦è†¨èƒ€æ“ä½œ
for i in range(iterations):
    mask = cv2.dilate(mask, kernel, iterations=1)

"""
iterations = 0 (é»˜è®¤):
  â†’ ä¸è¿›è¡Œé¢å¤–è†¨èƒ€
  â†’ ä¿æŒåŸå§‹æ£€æµ‹ç»“æœ

iterations = 1:
  â†’ è†¨èƒ€1æ¬¡
  â†’ çº¿æ¡ç•¥å¾®å˜ç²—
  â†’ å°æ–­è£‚è¢«å¡«è¡¥

iterations = 3:
  â†’ è†¨èƒ€3æ¬¡
  â†’ çº¿æ¡æ˜æ˜¾å˜ç²—
  â†’ æ–­è£‚è¿æ¥ï¼Œä½†å¯èƒ½åˆå¹¶è¿‘è·ç¦»çº¿æ¡ âš ï¸
"""
```

**ç¤ºä¾‹**:
```python
# åœºæ™¯ï¼šå¤„ç†æ–­è£‚çº¿æ¡
çº¿æ¡ç‰¹å¾: æœ‰å°é—´éš”æ–­è£‚

iterations = 0:
  â†’ çº¿æ¡ä¿æŒæ–­è£‚çŠ¶æ€
  â†’ å¯èƒ½æ— æ³•å½¢æˆå®Œæ•´è¡¨æ ¼ âŒ

iterations = 1:
  â†’ å°æ–­è£‚è¢«å¡«è¡¥
  â†’ çº¿æ¡åŸºæœ¬è¿ç»­ âœ…

iterations = 3:
  â†’ å¤§æ–­è£‚è¢«å¡«è¡¥
  â†’ ä½†è¿‘è·ç¦»çº¿æ¡å¯èƒ½åˆå¹¶ âš ï¸
```

**å½±å“èŒƒå›´**:
- â­â­â­â­ æ–­è£‚çº¿æ¡ä¿®å¤
- â­â­â­ çº¿æ¡è¿ç»­æ€§
- â­â­â­ å™ªç‚¹å»é™¤
- âš ï¸ **é£é™©**: è¿‡å¤šä¼šå¯¼è‡´çº¿æ¡åˆå¹¶

**ç†è®ºè®¾å®šèŒƒå›´**: 0 ~ 5
- **0**: ä¸è†¨èƒ€ï¼Œä¿æŒåŸå§‹
- **1-2**: è½»åº¦è†¨èƒ€ï¼Œä¿®å¤å°æ–­è£‚
- **3-5**: é‡åº¦è†¨èƒ€ï¼Œä¿®å¤å¤§æ–­è£‚ï¼ˆæ…ç”¨ï¼‰

**å¯ç”¨äºè®¾å®šçš„PDFé¡µé¢å±æ€§**:

| PDFå±æ€§ | æ¨èå€¼ | è¯´æ˜ |
|---------|--------|------|
| çº¿æ¡è´¨é‡ | è¿ç»­ â†’ 0 | æ— éœ€è†¨èƒ€ |
| çº¿æ¡è´¨é‡ | å°æ–­è£‚ â†’ 1-2 | è½»åº¦ä¿®å¤ |
| çº¿æ¡è´¨é‡ | å¤§æ–­è£‚ â†’ 2-3 | é‡åº¦ä¿®å¤ |
| PDFç±»å‹ | åŸç”ŸPDF â†’ 0 | çº¿æ¡é€šå¸¸è¿ç»­ |
| PDFç±»å‹ | æ‰«æPDF â†’ 1-2 | å¯èƒ½æœ‰æ–­è£‚ |
| åˆ†è¾¨ç‡ | ä½åˆ†è¾¨ç‡ â†’ 1-2 | è¡¥å¿åˆ†è¾¨ç‡æŸå¤± |
| åˆ†è¾¨ç‡ | é«˜åˆ†è¾¨ç‡ â†’ 0 | æ— éœ€è¡¥å¿ |

**æ¨èå€¼**: 0 (é»˜è®¤å€¼ï¼ŒæŒ‰éœ€è°ƒæ•´)

---

#### å‚æ•° 7: shift_text

**å®˜æ–¹å®šä¹‰**:
> {'l', 'r', 't', 'b'} Direction in which text in a spanning cell will flow.

**ä¸­æ–‡ç¿»è¯‘**:
{'l', 'r', 't', 'b'} è·¨å•å…ƒæ ¼æ–‡æœ¬æµåŠ¨çš„æ–¹å‘ã€‚

**ä½œç”¨**:
- å¤„ç†è·¨å•å…ƒæ ¼æ–‡æœ¬çš„å®šä½
- å°†æ–‡æœ¬ç§»åŠ¨åˆ°æœ‰è¾¹ç•Œçš„å•å…ƒæ ¼
- è§£å†³åˆå¹¶å•å…ƒæ ¼çš„æ–‡æœ¬åˆ†é…é—®é¢˜

**å·¥ä½œåŸç†**:
```python
# æºä»£ç å®ç° (lattice.py: _shift_index)
def shift_text(table, row_idx, col_idx, directions=['l', 't']):
    """
    å¯¹äºæ²¡æœ‰è¾¹ç•Œçš„å•å…ƒæ ¼ä¸­çš„æ–‡æœ¬ï¼ŒæŒ‰æŒ‡å®šæ–¹å‘ç§»åŠ¨:
    
    'l' (left): å‘å·¦ç§»åŠ¨ï¼Œç›´åˆ°æ‰¾åˆ°æœ‰å·¦è¾¹ç•Œçš„å•å…ƒæ ¼
    'r' (right): å‘å³ç§»åŠ¨ï¼Œç›´åˆ°æ‰¾åˆ°æœ‰å³è¾¹ç•Œçš„å•å…ƒæ ¼
    't' (top): å‘ä¸Šç§»åŠ¨ï¼Œç›´åˆ°æ‰¾åˆ°æœ‰ä¸Šè¾¹ç•Œçš„å•å…ƒæ ¼
    'b' (bottom): å‘ä¸‹ç§»åŠ¨ï¼Œç›´åˆ°æ‰¾åˆ°æœ‰ä¸‹è¾¹ç•Œçš„å•å…ƒæ ¼
    
    å¤šä¸ªæ–¹å‘æ—¶æŒ‰é¡ºåºåº”ç”¨
    """
```

**ç¤ºä¾‹**:
```python
# åœºæ™¯ï¼šåˆå¹¶å•å…ƒæ ¼
è¡¨æ ¼ç»“æ„:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Cell A (è·¨2åˆ—)  â”‚  â† æ–‡æœ¬åœ¨ä¸­é—´
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Cell B â”‚ Cell C â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ–‡æœ¬ "Title" ä½äºç¬¬1è¡Œç¬¬2åˆ— (æ— å·¦è¾¹ç•Œ)

shift_text = ['l']:
  â†’ å‘å·¦ç§»åŠ¨åˆ°ç¬¬1åˆ— (æœ‰å·¦è¾¹ç•Œ)
  â†’ æ–‡æœ¬åˆ†é…åˆ° Cell A å·¦ä¾§ âœ…

shift_text = ['r']:
  â†’ å‘å³ç§»åŠ¨åˆ°ç¬¬2åˆ— (æœ‰å³è¾¹ç•Œ)
  â†’ æ–‡æœ¬åˆ†é…åˆ° Cell A å³ä¾§

shift_text = ['l', 't']:
  â†’ å…ˆå‘å·¦ï¼Œå†å‘ä¸Š
  â†’ æ–‡æœ¬åˆ†é…åˆ°å·¦ä¸Šè§’
```

**å½±å“èŒƒå›´**:
- â­â­â­â­â­ åˆå¹¶å•å…ƒæ ¼æ–‡æœ¬å®šä½
- â­â­â­â­ è·¨å•å…ƒæ ¼æ–‡æœ¬å¤„ç†
- â­â­â­ è¡¨æ ¼æå–å‡†ç¡®æ€§

**ç†è®ºè®¾å®šèŒƒå›´**: 
- `None`: ä¸ç§»åŠ¨æ–‡æœ¬
- `['l']`: ä»…å‘å·¦ç§»åŠ¨
- `['t']`: ä»…å‘ä¸Šç§»åŠ¨
- `['l', 't']`: å‘å·¦ç„¶åå‘ä¸Š (é»˜è®¤)
- `['l', 'r', 't', 'b']`: æ‰€æœ‰æ–¹å‘

**å¯ç”¨äºè®¾å®šçš„PDFé¡µé¢å±æ€§**:

| è¡¨æ ¼ç‰¹å¾ | æ¨èå€¼ | è¯´æ˜ |
|---------|--------|------|
| æ ‡å‡†è¡¨æ ¼ | `['l', 't']` | é»˜è®¤é…ç½® |
| æ¨ªå‘åˆå¹¶å•å…ƒæ ¼å¤š | `['l']` | ä¸»è¦å¤„ç†æ¨ªå‘åˆå¹¶ |
| çºµå‘åˆå¹¶å•å…ƒæ ¼å¤š | `['t']` | ä¸»è¦å¤„ç†çºµå‘åˆå¹¶ |
| å¤æ‚åˆå¹¶ | `['l', 'r', 't', 'b']` | å…¨æ–¹å‘å¤„ç† |
| æ— åˆå¹¶å•å…ƒæ ¼ | `None` | ä¸éœ€è¦ç§»åŠ¨ |

**æ¨èå€¼**: `['l', 't']` (é»˜è®¤å€¼)

---

#### å‚æ•° 8: copy_text

**å®˜æ–¹å®šä¹‰**:
> {'h', 'v'} Direction in which text in a spanning cell will be copied over.

**ä¸­æ–‡ç¿»è¯‘**:
{'h', 'v'} è·¨å•å…ƒæ ¼æ–‡æœ¬å¤åˆ¶çš„æ–¹å‘ã€‚

**ä½œç”¨**:
- å°†åˆå¹¶å•å…ƒæ ¼çš„æ–‡æœ¬å¤åˆ¶åˆ°è·¨è¶Šçš„æ‰€æœ‰å•å…ƒæ ¼
- 'h': æ°´å¹³å¤åˆ¶ï¼ˆæ¨ªå‘åˆå¹¶å•å…ƒæ ¼ï¼‰
- 'v': å‚ç›´å¤åˆ¶ï¼ˆçºµå‘åˆå¹¶å•å…ƒæ ¼ï¼‰

**å·¥ä½œåŸç†**:
```python
# æ–‡æœ¬å¤åˆ¶é€»è¾‘
def copy_text(table, directions=None):
    """
    'h': å°†æ–‡æœ¬å¤åˆ¶åˆ°åŒä¸€è¡Œçš„ç›¸é‚»å•å…ƒæ ¼
    'v': å°†æ–‡æœ¬å¤åˆ¶åˆ°åŒä¸€åˆ—çš„ç›¸é‚»å•å…ƒæ ¼
    
    ç”¨äºå¡«å……åˆå¹¶å•å…ƒæ ¼çš„æ‰€æœ‰ä½ç½®
    """
```

**ç¤ºä¾‹**:
```python
# åœºæ™¯ï¼šæ¨ªå‘åˆå¹¶å•å…ƒæ ¼
è¡¨æ ¼:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   "Title"      â”‚ Cell B â”‚  â† "Title"è·¨2åˆ—
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Cell C â”‚ Cell Dâ”‚ Cell E â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

copy_text = None:
  Row 0: ["Title", "", "Cell B"]
  â†’ ç¬¬2åˆ—ä¸ºç©º

copy_text = ['h']:
  Row 0: ["Title", "Title", "Cell B"]
  â†’ "Title" å¤åˆ¶åˆ°ç¬¬2åˆ— âœ…

copy_text = ['v']:
  â†’ å‚ç›´å¤åˆ¶ï¼Œä¸å½±å“æ­¤æƒ…å†µ
```

**å½±å“èŒƒå›´**:
- â­â­â­â­ åˆå¹¶å•å…ƒæ ¼å†…å®¹å®Œæ•´æ€§
- â­â­â­ æ•°æ®ç»“æ„ä¸€è‡´æ€§
- â­â­â­ åç»­å¤„ç†ä¾¿åˆ©æ€§

**ç†è®ºè®¾å®šèŒƒå›´**:
- `None`: ä¸å¤åˆ¶ (é»˜è®¤)
- `['h']`: ä»…æ°´å¹³å¤åˆ¶
- `['v']`: ä»…å‚ç›´å¤åˆ¶
- `['h', 'v']`: åŒå‘å¤åˆ¶

**å¯ç”¨äºè®¾å®šçš„PDFé¡µé¢å±æ€§**:

| è¡¨æ ¼ç‰¹å¾ | æ¨èå€¼ | è¯´æ˜ |
|---------|--------|------|
| æ— åˆå¹¶å•å…ƒæ ¼ | `None` | ä¸éœ€è¦å¤åˆ¶ |
| æ¨ªå‘åˆå¹¶å¤š | `['h']` | æ°´å¹³å¤åˆ¶ |
| çºµå‘åˆå¹¶å¤š | `['v']` | å‚ç›´å¤åˆ¶ |
| å¤æ‚åˆå¹¶ | `['h', 'v']` | åŒå‘å¤åˆ¶ |
| éœ€è¦å®Œæ•´æ•°æ® | `['h', 'v']` | ç¡®ä¿æ— ç©ºå•å…ƒæ ¼ |

**æ¨èå€¼**: `None` (é»˜è®¤ï¼ŒæŒ‰éœ€è®¾ç½®)

---

#### å‚æ•° 9: split_text

**å®˜æ–¹å®šä¹‰**:
> Split text that spans across multiple cells.

**ä¸­æ–‡ç¿»è¯‘**:
åˆ†å‰²è·¨è¶Šå¤šä¸ªå•å…ƒæ ¼çš„æ–‡æœ¬ã€‚

**ä½œç”¨**:
- å°†è·¨å•å…ƒæ ¼çš„æ–‡æœ¬æ‹†åˆ†åˆ°å„ä¸ªå•å…ƒæ ¼
- å¤„ç†æ–‡æœ¬æœªæ­£ç¡®å¯¹é½åˆ°å•å…ƒæ ¼çš„æƒ…å†µ

**ç¤ºä¾‹**:
```python
# åœºæ™¯ï¼šæ–‡æœ¬è·¨è¶Šå¤šä¸ªå•å…ƒæ ¼
å•å…ƒæ ¼: [Cell1] [Cell2] [Cell3]
æ–‡æœ¬:   "Long text spanning multiple cells"

split_text = False:
  â†’ å®Œæ•´æ–‡æœ¬åˆ†é…åˆ°ç¬¬ä¸€ä¸ªå•å…ƒæ ¼
  â†’ Cell1: "Long text spanning multiple cells"
  â†’ Cell2: ""
  â†’ Cell3: ""

split_text = True:
  â†’ æ–‡æœ¬æŒ‰å•å…ƒæ ¼è¾¹ç•Œåˆ†å‰²
  â†’ Cell1: "Long text"
  â†’ Cell2: "spanning multiple"
  â†’ Cell3: "cells"
```

**å½±å“èŒƒå›´**:
- â­â­â­ æ–‡æœ¬åˆ†å‰²å‡†ç¡®æ€§
- â­â­â­ å•å…ƒæ ¼å†…å®¹è´¨é‡

**ç†è®ºè®¾å®šèŒƒå›´**: True / False

**æ¨èå€¼**: `False` (é»˜è®¤å€¼)

---

#### å‚æ•° 10: strip_text

**å®˜æ–¹å®šä¹‰**:
> Characters that should be stripped from a string before assigning it to a cell.

**ä¸­æ–‡ç¿»è¯‘**:
åœ¨å°†å­—ç¬¦ä¸²åˆ†é…ç»™å•å…ƒæ ¼ä¹‹å‰åº”è¯¥åˆ é™¤çš„å­—ç¬¦ã€‚

**ä½œç”¨**:
- æ¸…ç†æ–‡æœ¬ä¸­çš„ç‰¹å®šå­—ç¬¦
- å»é™¤å¹²æ‰°å­—ç¬¦

**ç¤ºä¾‹**:
```python
strip_text = '.$':
  åŸæ–‡æœ¬: "$100.00"
  å¤„ç†å: "10000"

strip_text = '':
  ä¸åˆ é™¤ä»»ä½•å­—ç¬¦ (é»˜è®¤)
```

**æ¨èå€¼**: `''` (é»˜è®¤å€¼ï¼Œä¸åˆ é™¤)

---

#### å‚æ•° 11: flag_size

**å®˜æ–¹å®šä¹‰**:
> Flag text based on font size. Useful to detect super/subscripts. Adds <s></s> around flagged text.

**ä¸­æ–‡ç¿»è¯‘**:
åŸºäºå­—ä½“å¤§å°æ ‡è®°æ–‡æœ¬ã€‚ç”¨äºæ£€æµ‹ä¸Šæ ‡/ä¸‹æ ‡ã€‚åœ¨æ ‡è®°çš„æ–‡æœ¬å‘¨å›´æ·»åŠ <s></s>ã€‚

**ä½œç”¨**:
- æ ‡è®°ä¸åŒå­—å·çš„æ–‡æœ¬
- è¯†åˆ«ä¸Šæ ‡ã€ä¸‹æ ‡

**æ¨èå€¼**: `False` (é»˜è®¤å€¼)

---

### 3. Latticeæ¨¡å¼å‚æ•°å¿«é€Ÿå‚è€ƒè¡¨

| å‚æ•° | é»˜è®¤å€¼ | æ¨èèŒƒå›´ | å½±å“çº§åˆ« | ä¸»è¦ä½œç”¨ |
|------|--------|---------|---------|---------|
| `line_scale` | 15 | 10-100 | â­â­â­â­â­ | æ§åˆ¶çº¿æ¡æ£€æµ‹çµæ•åº¦ |
| `line_tol` | 2 | 0-10 | â­â­â­â­ | åˆå¹¶æ¥è¿‘çš„çº¿æ¡ |
| `joint_tol` | 2 | 0-10 | â­â­â­â­â­ | åˆ¤æ–­çº¿æ¡äº¤ç‚¹ |
| `threshold_blocksize` | 15 | 3-51 (å¥‡æ•°) | â­â­â­â­ | è‡ªé€‚åº”é˜ˆå€¼é‚»åŸŸå¤§å° |
| `threshold_constant` | -2 | -10~10 | â­â­â­â­ | è°ƒæ•´äºŒå€¼åŒ–é˜ˆå€¼ |
| `iterations` | 0 | 0-5 | â­â­â­ | è†¨èƒ€æ“ä½œæ¬¡æ•° |
| `shift_text` | `['l', 't']` | æ–¹å‘ç»„åˆ | â­â­â­â­â­ | è·¨å•å…ƒæ ¼æ–‡æœ¬ç§»åŠ¨ |
| `copy_text` | `None` | æ–¹å‘ç»„åˆ | â­â­â­â­ | è·¨å•å…ƒæ ¼æ–‡æœ¬å¤åˆ¶ |
| `split_text` | `False` | True/False | â­â­â­ | åˆ†å‰²è·¨å•å…ƒæ ¼æ–‡æœ¬ |
| `strip_text` | `''` | å­—ç¬¦ä¸² | â­â­ | æ¸…ç†ç‰¹å®šå­—ç¬¦ |
| `flag_size` | `False` | True/False | â­â­ | æ ‡è®°ä¸åŒå­—å· |

---

## ğŸŒŠ Streamæ¨¡å¼ - æ— æ¡†è¡¨æ ¼æå–

### 1. Streamæ¨¡å¼å¤„ç†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è¾“å…¥: PDFæ–‡ä»¶å’Œé¡µé¢                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æå–æ–‡æœ¬å¯¹è±¡                                               â”‚
â”‚    - æå–æ‰€æœ‰æ–‡æœ¬è¡Œ (horizontal_text)                        â”‚
â”‚    - æå–å‚ç›´æ–‡æœ¬ (vertical_text)                            â”‚
â”‚    - è·å–æ–‡æœ¬åæ ‡ã€å­—ä½“ã€å¤§å°ç­‰å±æ€§                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æ–‡æœ¬æ’åº (æŒ‰é˜…è¯»é¡ºåº)                                      â”‚
â”‚    - æŒ‰Yåæ ‡é™åºæ’åº (ä»ä¸Šåˆ°ä¸‹)                              â”‚
â”‚    - åŒä¸€è¡Œå†…æŒ‰Xåæ ‡å‡åºæ’åº (ä»å·¦åˆ°å³)                      â”‚
â”‚    - å…¬å¼: sort(key=lambda x: (-x.y0, x.x0))                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ç”Ÿæˆæ–‡æœ¬è¾¹ç¼˜ (TextEdges) - Nurminenç®—æ³•æ ¸å¿ƒ               â”‚
â”‚    - åˆ›å»ºTextEdgeså¯¹è±¡ï¼Œè®¾ç½®edge_tolå‚æ•°                     â”‚
â”‚    - åˆ†ææ–‡æœ¬å¯¹é½ï¼Œç”Ÿæˆè™šæ‹Ÿè¾¹ç¼˜:                              â”‚
â”‚      * Left edges: å·¦å¯¹é½æ–‡æœ¬                                â”‚
â”‚      * Right edges: å³å¯¹é½æ–‡æœ¬                               â”‚
â”‚      * Middle edges: ä¸­å¿ƒå¯¹é½æ–‡æœ¬                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æ–‡æœ¬è¾¹ç¼˜æ‰©å±• (edge_tol)                                   â”‚
â”‚    - å¯¹æ¯ä¸ªæ–‡æœ¬è¡Œï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ–‡æœ¬è¾¹ç¼˜:                        â”‚
â”‚      * å¦‚æœ |textline.y0 - textedge.y0| <= edge_tol         â”‚
â”‚        â†’ æ‰©å±•textedgeåˆ°è¯¥æ–‡æœ¬è¡Œ                              â”‚
â”‚    - å‘ä¸‹æ‰©å±•æ–‡æœ¬è¾¹ç¼˜ï¼Œè¿æ¥ç›¸é‚»æ–‡æœ¬è¡Œ                         â”‚
â”‚    - å½¢æˆè¿ç»­çš„å‚ç›´è¾¹ç¼˜                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ç­›é€‰ç›¸å…³è¾¹ç¼˜ (get_relevant)                               â”‚
â”‚    - è¿‡æ»¤æ¡ä»¶:                                                â”‚
â”‚      * æ–‡æœ¬è¾¹ç¼˜å¿…é¡»è·¨è¶Šè‡³å°‘4è¡Œ (TEXTEDGE_REQUIRED_ELEMENTS)  â”‚
â”‚      * is_valid = True                                       â”‚
â”‚    - ä¿ç•™ç›¸å…³çš„å‚ç›´è¾¹ç¼˜                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. æ¨æ–­è¡¨æ ¼åŒºåŸŸ (get_table_areas)                            â”‚
â”‚    - åŸºäºç›¸å…³æ–‡æœ¬è¾¹ç¼˜å’Œæ–‡æœ¬è¡Œåˆ†å¸ƒ                             â”‚
â”‚    - æŸ¥æ‰¾æ–‡æœ¬å¯†é›†åŒºåŸŸ                                         â”‚
â”‚    - ç”Ÿæˆè¡¨æ ¼è¾¹ç•Œæ¡† (bbox)                                    â”‚
â”‚    - å¦‚æœæ²¡æœ‰æ‰¾åˆ° â†’ å°†æ•´é¡µä½œä¸ºè¡¨æ ¼åŒºåŸŸ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. è¡Œåˆ†ç»„ (_group_rows) - åº”ç”¨row_tol                        â”‚
â”‚    - å°†bboxå†…çš„æ–‡æœ¬è¡ŒæŒ‰Yåæ ‡åˆ†ç»„:                            â”‚
â”‚      * å¦‚æœ |textline1.y0 - textline2.y0| <= row_tol        â”‚
â”‚        â†’ å±äºåŒä¸€è¡Œ                                           â”‚
â”‚    - ç”Ÿæˆè¡Œç»„: [[row1_texts], [row2_texts], ...]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. åˆ—æ•°æ¨æ–­å’Œåˆ—è¾¹ç•Œç”Ÿæˆ                                       â”‚
â”‚    - ç»Ÿè®¡æ¯è¡Œçš„å…ƒç´ æ•°é‡                                       â”‚
â”‚    - è®¡ç®—ä¼—æ•° (mode) â†’ æ¨æ–­åˆ—æ•°                              â”‚
â”‚    - æå–æœ€å¸¸è§åˆ—æ•°è¡Œçš„æ–‡æœ¬åæ ‡                               â”‚
â”‚    - ç”Ÿæˆåˆå§‹åˆ—è¾¹ç•Œ: [(x0, x1), (x0, x1), ...]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. åˆå¹¶åˆ— (_merge_columns) - åº”ç”¨column_tol                 â”‚
â”‚     - å¯¹ç›¸é‚»åˆ—è¾¹ç•Œ:                                           â”‚
â”‚       * å¦‚æœ |col1.x1 - col2.x0| <= column_tol              â”‚
â”‚         â†’ åˆå¹¶ä¸ºä¸€åˆ—                                          â”‚
â”‚     - ç”Ÿæˆåˆå¹¶åçš„åˆ—è¾¹ç•Œ                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 11. æ·»åŠ é¢å¤–åˆ— (_add_columns)                                â”‚
â”‚     - æ£€æŸ¥åˆ—é—´éš™ä¸­æ˜¯å¦æœ‰æ–‡æœ¬                                  â”‚
â”‚     - å¦‚æœæœ‰ â†’ æ·»åŠ æ–°åˆ—                                       â”‚
â”‚     - ç¡®ä¿è¦†ç›–æ‰€æœ‰æ–‡æœ¬                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 12. ç”Ÿæˆè¡¨æ ¼å¯¹è±¡                                              â”‚
â”‚     - åˆ›å»ºTableå¯¹è±¡ (cols Ã— rows ç½‘æ ¼)                       â”‚
â”‚     - å°†æ–‡æœ¬åˆ†é…åˆ°å¯¹åº”å•å…ƒæ ¼                                  â”‚
â”‚     - Streamæ¨¡å¼ä¸‹æ‰€æœ‰è¾¹ç¼˜é»˜è®¤ä¸ºFalse (æ— å®é™…è¾¹æ¡†)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 13. è¾“å‡º: Tableå¯¹è±¡åˆ—è¡¨                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. Streamæ¨¡å¼å‚æ•°è¯¦ç»†è¯´æ˜

#### å‚æ•° 1: edge_tol

**å®˜æ–¹å®šä¹‰**:
> Tolerance parameter for extending textedges vertically.

**ä¸­æ–‡ç¿»è¯‘**:
ç”¨äºå‚ç›´æ‰©å±•æ–‡æœ¬è¾¹ç¼˜çš„å®¹å·®å‚æ•°ã€‚

**ä½œç”¨**:
- æ§åˆ¶æ–‡æœ¬è¾¹ç¼˜å‘ä¸‹æ‰©å±•çš„è·ç¦»
- è¿æ¥å‚ç›´æ–¹å‘ä¸Šçš„å¯¹é½æ–‡æœ¬
- å½¢æˆå®Œæ•´çš„åˆ—è¾¹ç•Œ

**å·¥ä½œåŸç†**:
```python
# æºä»£ç å®ç° (core.py: TextEdge.update_coords)
def update_coords(textedge, textline, edge_tol=50):
    """
    æ£€æŸ¥æ–‡æœ¬è¡Œæ˜¯å¦ä¸æ–‡æœ¬è¾¹ç¼˜å¯¹é½:
    
    å¦‚æœ |textedge.y0 - textline.y0| <= edge_tol:
        â†’ æ‰©å±•æ–‡æœ¬è¾¹ç¼˜åˆ°è¯¥æ–‡æœ¬è¡Œ
        â†’ textedge.y0 = textline.y0 (å‘ä¸‹æ‰©å±•)
        â†’ å¢åŠ ç›¸äº¤æ–‡æœ¬è¡Œè®¡æ•°
    
    å¦‚æœç›¸äº¤æ–‡æœ¬è¡Œ > 4:
        â†’ textedge.is_valid = True (æœ‰æ•ˆè¾¹ç¼˜)
    """
```

**ç¤ºä¾‹**:
```python
# åœºæ™¯ï¼šå‚ç›´æ–‡æœ¬å¯¹é½
æ–‡æœ¬è¡Œ:
  Row1: "Name"   at y=100
  Row2: "Alice"  at y=120  # é—´è·20
  Row3: "Bob"    at y=140  # é—´è·20
  Row4: "Carol"  at y=165  # é—´è·25

å·¦å¯¹é½: x=50

edge_tol = 50:
  â†’ Row1-Row2: |100-120| = 20 <= 50 â†’ æ‰©å±• âœ…
  â†’ Row2-Row3: |120-140| = 20 <= 50 â†’ æ‰©å±• âœ…
  â†’ Row3-Row4: |140-165| = 25 <= 50 â†’ æ‰©å±• âœ…
  â†’ å½¢æˆå®Œæ•´åˆ—è¾¹ç•Œ âœ…

edge_tol = 15:
  â†’ Row1-Row2: |100-120| = 20 > 15 â†’ ä¸æ‰©å±• âŒ
  â†’ Row2-Row3: |120-140| = 20 > 15 â†’ ä¸æ‰©å±• âŒ
  â†’ è¾¹ç¼˜æ–­è£‚ï¼Œæ— æ³•å½¢æˆåˆ— âŒ

edge_tol = 100:
  â†’ æ‰€æœ‰è¡Œéƒ½æ‰©å±•
  â†’ ä½†å¯èƒ½é”™è¯¯è¿æ¥ä¸åŒè¡¨æ ¼çš„åˆ— âš ï¸
```

**å½±å“èŒƒå›´**:
- â­â­â­â­â­ åˆ—è¾¹ç•Œè¯†åˆ«æˆåŠŸç‡
- â­â­â­â­â­ è¡¨æ ¼æ£€æµ‹æˆåŠŸç‡
- â­â­â­â­ è¡Œé—´è·å®¹å¿åº¦
- âš ï¸ **é£é™©**: è¿‡å¤§ä¼šé”™è¯¯åˆå¹¶ä¸åŒè¡¨æ ¼ï¼Œè¿‡å°ä¼šæ— æ³•å½¢æˆåˆ—

**ç†è®ºè®¾å®šèŒƒå›´**: 10 ~ 1000 ç‚¹
- **10-30**: ä¸¥æ ¼æ¨¡å¼ï¼Œè¡Œé—´è·å¿…é¡»å¾ˆå°
- **30-100**: æ ‡å‡†èŒƒå›´ï¼Œé€‚åˆå¤§å¤šæ•°è¡¨æ ¼
- **100-500**: å®½æ¾æ¨¡å¼ï¼Œå®¹å¿è¾ƒå¤§è¡Œé—´è·
- **500-1000**: æå®½æ¾ï¼Œç”¨äºç‰¹æ®Šæ ¼å¼

**å¯ç”¨äºè®¾å®šçš„PDFé¡µé¢å±æ€§**:

| PDFå±æ€§ | è®¡ç®—å…¬å¼ | è¯´æ˜ |
|---------|----------|------|
| è¡Œé—´è· | `avg_line_gap * 2~5` | è¡Œé—´è·çš„2-5å€ |
| è¡Œé«˜ | `avg_line_height * 1~3` | è¡Œé«˜çš„1-3å€ |
| ç»¼åˆ | `line_gap * 3 + line_height * 2` | å·¥ç¨‹ä¸­ä½¿ç”¨çš„å…¬å¼ |
| é¡µé¢é«˜åº¦ | `page_height * 0.05~0.15` | é¡µé¢é«˜åº¦çš„5-15% |
| è¡¨æ ¼é—´è· | å•è¡¨æ ¼é¡µé¢ â†’ 100-200 | å®¹å¿è¾ƒå¤§é—´è· |
| è¡¨æ ¼é—´è· | å¤šè¡¨æ ¼é¡µé¢ â†’ 30-80 | é¿å…è·¨è¡¨æ ¼è¿æ¥ |
| è¡Œé—´è·åˆ†å¸ƒ | å‡åŒ€ â†’ å‡å° | ç²¾ç¡®æ£€æµ‹ |
| è¡Œé—´è·åˆ†å¸ƒ | ä¸å‡ â†’ å¢å¤§ | å®¹å¿å˜åŒ– |

**æ¨èè®¾ç½®é€»è¾‘**:
```python
# åŸºäºè¡Œé—´è·å’Œè¡Œé«˜
edge_tol = avg_line_gap * 3 + avg_line_height * 2
edge_tol = max(20, min(edge_tol, 800))  # é™åˆ¶åœ¨[20, 800]
```

**æ¨èå€¼**: 50 (é»˜è®¤å€¼)

---

#### å‚æ•° 2: row_tol

**å®˜æ–¹å®šä¹‰**:
> Tolerance parameter used to combine text vertically, to generate rows.

**ä¸­æ–‡ç¿»è¯‘**:
ç”¨äºå‚ç›´ç»„åˆæ–‡æœ¬ä»¥ç”Ÿæˆè¡Œçš„å®¹å·®å‚æ•°ã€‚

**ä½œç”¨**:
- åˆ¤æ–­æ–‡æœ¬æ˜¯å¦å±äºåŒä¸€è¡Œ
- å®¹å¿åŒä¸€è¡Œæ–‡æœ¬çš„å‚ç›´åå·®
- å½±å“è¡Œçš„åˆå¹¶

**å·¥ä½œåŸç†**:
```python
# æºä»£ç å®ç° (base.py: _group_rows)
def group_rows(textlines, row_tol=2):
    """
    å°†æ–‡æœ¬è¡Œåˆ†ç»„:
    
    å¯¹äºæ¯ä¸ªæ–‡æœ¬è¡Œ:
        å¦‚æœ |current_textline.y0 - last_textline.y0| <= row_tol:
            â†’ å±äºåŒä¸€è¡Œï¼Œæ·»åŠ åˆ°å½“å‰è¡Œç»„
        å¦åˆ™:
            â†’ å¼€å§‹æ–°è¡Œç»„
    
    è¿”å›: [[row1_texts], [row2_texts], ...]
    """
```

**ç¤ºä¾‹**:
```python
# åœºæ™¯ï¼šæ–‡æœ¬åŸºçº¿è½»å¾®ä¸é½
æ–‡æœ¬è¡Œ:
  "Name"   at y=100.0
  "Age"    at y=100.5  # åå·®0.5
  "City"   at y=101.8  # åå·®1.8
  
  "Alice"  at y=120.0  # æ–°è¡Œ

row_tol = 2:
  â†’ "Name", "Age", "City" éƒ½åœ¨å®¹å·®å†…
  â†’ è¯†åˆ«ä¸ºåŒä¸€è¡Œ âœ…
  â†’ Row1: ["Name", "Age", "City"]
  â†’ Row2: ["Alice"]

row_tol = 1:
  â†’ "Name", "Age" åœ¨å®¹å·®å†… â†’ åŒä¸€è¡Œ
  â†’ "City" è¶…å‡ºå®¹å·® â†’ æ–°è¡Œ âŒ
  â†’ Row1: ["Name", "Age"]
  â†’ Row2: ["City"]  # é”™è¯¯åˆ†å‰²

row_tol = 25:
  â†’ æ‰€æœ‰æ–‡æœ¬éƒ½åœ¨å®¹å·®å†…
  â†’ å…¨éƒ¨è¯†åˆ«ä¸ºåŒä¸€è¡Œ âŒ
```

**å½±å“èŒƒå›´**:
- â­â­â­â­â­ è¡Œè¯†åˆ«å‡†ç¡®æ€§
- â­â­â­â­ è¡Œæ•°æ­£ç¡®æ€§
- â­â­â­â­ åˆ—æ•°æ¨æ–­
- âš ï¸ **é£é™©**: è¿‡å¤§ä¼šåˆå¹¶ä¸åŒè¡Œï¼Œè¿‡å°ä¼šåˆ†å‰²åŒä¸€è¡Œ

**ç†è®ºè®¾å®šèŒƒå›´**: 0 ~ 20 ç‚¹
- **0-1**: ä¸¥æ ¼æ¨¡å¼ï¼ŒåŸºçº¿å¿…é¡»ç²¾ç¡®å¯¹é½
- **1-5**: æ ‡å‡†èŒƒå›´ï¼Œå®¹å¿å°åå·®
- **5-20**: å®½æ¾æ¨¡å¼ï¼Œå®¹å¿è¾ƒå¤§åå·®

**å¯ç”¨äºè®¾å®šçš„PDFé¡µé¢å±æ€§**:

| PDFå±æ€§ | è®¡ç®—å…¬å¼ | è¯´æ˜ |
|---------|----------|------|
| å­—ç¬¦é«˜åº¦ | `avg_char_height * 0.15~0.25` | å­—ç¬¦é«˜åº¦çš„15-25% |
| è¡Œé«˜ | `line_height * 0.1~0.2` | è¡Œé«˜çš„10-20% |
| åŸºçº¿æŠ–åŠ¨ | `baseline_std * 2~3` | è¦†ç›–2-3å€æ ‡å‡†å·® |
| PDFè´¨é‡ | é«˜è´¨é‡ â†’ 1~2 | åŸºçº¿ç¨³å®š |
| PDFè´¨é‡ | ä½è´¨é‡ â†’ 3~5 | å®¹å¿åå·® |
| æ‰«æPDF | æ‰«æ â†’ 4~8 | å¯¹é½è¯¯å·®å¤§ |
| å­—ä½“å¤§å° | å°å­—ä½“ â†’ å‡å° | æŒ‰æ¯”ä¾‹ç¼©æ”¾ |
| å­—ä½“å¤§å° | å¤§å­—ä½“ â†’ å¢å¤§ | æŒ‰æ¯”ä¾‹ç¼©æ”¾ |

**æ¨èè®¾ç½®é€»è¾‘**:
```python
# åŸºäºè¡Œé«˜
row_tol = avg_line_height * 0.15
row_tol = max(1, min(row_tol, 10))  # é™åˆ¶åœ¨[1, 10]
```

**æ¨èå€¼**: 2 (é»˜è®¤å€¼)

---

#### å‚æ•° 3: column_tol

**å®˜æ–¹å®šä¹‰**:
> Tolerance parameter used to combine text horizontally, to generate columns.

**ä¸­æ–‡ç¿»è¯‘**:
ç”¨äºæ°´å¹³ç»„åˆæ–‡æœ¬ä»¥ç”Ÿæˆåˆ—çš„å®¹å·®å‚æ•°ã€‚

**ä½œç”¨**:
- åˆå¹¶ç›¸é‚»çš„åˆ—è¾¹ç•Œ
- å®¹å¿åˆ—è¾¹ç•Œçš„æ°´å¹³åå·®
- ç®€åŒ–åˆ—ç»“æ„

**å·¥ä½œåŸç†**:
```python
# æºä»£ç å®ç° (base.py: _merge_columns)
def merge_columns(cols, column_tol=0):
    """
    åˆå¹¶ç›¸é‚»åˆ—:
    
    å¯¹äºç›¸é‚»åˆ— (col1, col2):
        å¦‚æœ |col1.x1 - col2.x0| <= column_tol:
            â†’ åˆå¹¶ä¸ºä¸€åˆ—
            â†’ new_col = (col1.x0, col2.x1)
    
    è¿”å›: åˆå¹¶åçš„åˆ—è¾¹ç•Œåˆ—è¡¨
    """
```

**ç¤ºä¾‹**:
```python
# åœºæ™¯ï¼šæ¨æ–­çš„åˆ—è¾¹ç•Œç•¥æœ‰é‡å 
åˆå§‹åˆ—è¾¹ç•Œ:
  Col1: (0, 100)
  Col2: (98, 200)   # ä¸Col1é‡å 2pt
  Col3: (202, 300)  # ä¸Col2é—´éš”2pt

column_tol = 0:
  â†’ ä¸åˆå¹¶
  â†’ ä¿ç•™3åˆ—
  â†’ Col1, Col2æœ‰é‡å  âš ï¸

column_tol = 3:
  â†’ |100 - 98| = 2 <= 3 â†’ Col1, Col2 åˆå¹¶ âœ…
  â†’ |200 - 202| = 2 <= 3 â†’ åˆå¹¶åçš„åˆ—ä¸Col3åˆå¹¶ âš ï¸
  â†’ å…¨éƒ¨åˆå¹¶ä¸º1åˆ— âŒ

column_tol = 2:
  â†’ Col1, Col2 åˆå¹¶
  â†’ åˆå¹¶åˆ—ä¸Col3ä¸åˆå¹¶
  â†’ è¯†åˆ«ä¸º2åˆ— âœ…
```

**å½±å“èŒƒå›´**:
- â­â­â­â­ åˆ—æ•°æ­£ç¡®æ€§
- â­â­â­ åˆ—è¾¹ç•Œå‡†ç¡®æ€§
- â­â­â­ å•å…ƒæ ¼æ–‡æœ¬åˆ†é…
- âš ï¸ **é£é™©**: è¿‡å¤§ä¼šé”™è¯¯åˆå¹¶åˆ—

**ç†è®ºè®¾å®šèŒƒå›´**: 0 ~ 20 ç‚¹
- **0**: ä¸åˆå¹¶ï¼Œä¿ç•™æ‰€æœ‰æ¨æ–­çš„åˆ—
- **1-5**: æ ‡å‡†èŒƒå›´ï¼Œåˆå¹¶å°é‡å /é—´éš™
- **5-20**: å®½æ¾æ¨¡å¼ï¼Œåˆå¹¶è¾ƒå¤§é—´éš™

**å¯ç”¨äºè®¾å®šçš„PDFé¡µé¢å±æ€§**:

| PDFå±æ€§ | è®¡ç®—å…¬å¼ | è¯´æ˜ |
|---------|----------|------|
| å­—ç¬¦å®½åº¦ | `avg_char_width * 0.3~0.8` | å­—ç¬¦å®½åº¦çš„30-80% |
| å•è¯é—´è· | `avg_word_gap * 0.3~0.5` | å•è¯é—´è·çš„30-50% |
| åˆ—é—´è· | `min_column_gap * 0.1~0.2` | åˆ—é—´è·çš„10-20% |
| å¯¹é½ç²¾åº¦ | é«˜ç²¾åº¦ â†’ 0~1 | ä¸éœ€è¦åˆå¹¶ |
| å¯¹é½ç²¾åº¦ | ä½ç²¾åº¦ â†’ 2~5 | å®¹å¿åå·® |
| åˆ—æ•° | å°‘åˆ— (2-3) â†’ 3~5 | å¯å®½æ¾åˆå¹¶ |
| åˆ—æ•° | å¤šåˆ— (>5) â†’ 0~2 | ä¸¥æ ¼é¿å…è¯¯åˆå¹¶ |

**æ¨èè®¾ç½®é€»è¾‘**:
```python
# åŸºäºå•è¯é—´è·å’Œå­—ç¬¦å®½åº¦
column_tol = min(avg_word_gap * 0.5, avg_char_width * 1.5)
column_tol = max(0, min(column_tol, 5))  # é™åˆ¶åœ¨[0, 5]
```

**æ¨èå€¼**: 0 (é»˜è®¤å€¼ï¼Œä¸åˆå¹¶)

---

#### å‚æ•° 4: split_text

**å®˜æ–¹å®šä¹‰**:
> Split text that spans across multiple cells.

**ä¸­æ–‡ç¿»è¯‘**:
åˆ†å‰²è·¨è¶Šå¤šä¸ªå•å…ƒæ ¼çš„æ–‡æœ¬ã€‚

**ä½œç”¨**: åŒLatticeæ¨¡å¼

**æ¨èå€¼**: `False` (é»˜è®¤å€¼)

---

#### å‚æ•° 5: strip_text

**å®˜æ–¹å®šä¹‰**:
> Characters that should be stripped from a string before assigning it to a cell.

**ä¸­æ–‡ç¿»è¯‘**:
åœ¨å°†å­—ç¬¦ä¸²åˆ†é…ç»™å•å…ƒæ ¼ä¹‹å‰åº”è¯¥åˆ é™¤çš„å­—ç¬¦ã€‚

**ä½œç”¨**: åŒLatticeæ¨¡å¼

**æ¨èå€¼**: `''` (é»˜è®¤å€¼)

---

#### å‚æ•° 6: flag_size

**å®˜æ–¹å®šä¹‰**:
> Flag text based on font size. Useful to detect super/subscripts. Adds <s></s> around flagged text.

**ä¸­æ–‡ç¿»è¯‘**:
åŸºäºå­—ä½“å¤§å°æ ‡è®°æ–‡æœ¬ã€‚ç”¨äºæ£€æµ‹ä¸Šæ ‡/ä¸‹æ ‡ã€‚åœ¨æ ‡è®°çš„æ–‡æœ¬å‘¨å›´æ·»åŠ <s></s>ã€‚

**ä½œç”¨**: åŒLatticeæ¨¡å¼

**æ¨èå€¼**: `False` (é»˜è®¤å€¼)

---

### 3. Streamæ¨¡å¼å‚æ•°å¿«é€Ÿå‚è€ƒè¡¨

| å‚æ•° | é»˜è®¤å€¼ | æ¨èèŒƒå›´ | å½±å“çº§åˆ« | ä¸»è¦ä½œç”¨ |
|------|--------|---------|---------|---------|
| `edge_tol` | 50 | 10-1000 | â­â­â­â­â­ | æ§åˆ¶åˆ—è¾¹ç•Œå½¢æˆ |
| `row_tol` | 2 | 0-20 | â­â­â­â­â­ | åˆ¤æ–­åŒä¸€è¡Œæ–‡æœ¬ |
| `column_tol` | 0 | 0-20 | â­â­â­â­ | åˆå¹¶ç›¸é‚»åˆ— |
| `split_text` | `False` | True/False | â­â­â­ | åˆ†å‰²è·¨å•å…ƒæ ¼æ–‡æœ¬ |
| `strip_text` | `''` | å­—ç¬¦ä¸² | â­â­ | æ¸…ç†ç‰¹å®šå­—ç¬¦ |
| `flag_size` | `False` | True/False | â­â­ | æ ‡è®°ä¸åŒå­—å· |

---

## ğŸ“Š Lattice vs Stream æ¨¡å¼å¯¹æ¯”

| ç»´åº¦ | Latticeæ¨¡å¼ | Streamæ¨¡å¼ |
|------|------------|-----------|
| **é€‚ç”¨åœºæ™¯** | æœ‰æ˜æ˜¾çº¿æ¡è¾¹æ¡†çš„è¡¨æ ¼ | æ— è¾¹æ¡†æˆ–è¾¹æ¡†ä¸å®Œæ•´çš„è¡¨æ ¼ |
| **æ£€æµ‹ä¾æ®** | PDFä¸­çš„çº¿æ¡å¯¹è±¡ | æ–‡æœ¬å¯¹é½å’Œé—´è· |
| **å¤„ç†æµç¨‹** | PDFâ†’å›¾åƒâ†’çº¿æ¡æ£€æµ‹â†’äº¤ç‚¹â†’å•å…ƒæ ¼ | PDFâ†’æ–‡æœ¬â†’å¯¹é½åˆ†æâ†’è¡Œåˆ—æ¨æ–­â†’å•å…ƒæ ¼ |
| **æ ¸å¿ƒå‚æ•°** | `line_scale`, `line_tol`, `joint_tol` | `edge_tol`, `row_tol`, `column_tol` |
| **ä¼˜åŠ¿** | ç²¾ç¡®ã€ç›´æ¥ã€é€Ÿåº¦å¿« | æ— éœ€çº¿æ¡ä¹Ÿèƒ½è¯†åˆ« |
| **åŠ£åŠ¿** | éœ€è¦æ¸…æ™°çº¿æ¡ | ä¾èµ–æ–‡æœ¬å¯¹é½è´¨é‡ |
| **å¤„ç†æ—¶é—´** | è¾ƒå¿« (éœ€å›¾åƒè½¬æ¢) | å¿« (ä»…å¤„ç†æ–‡æœ¬) |
| **å‡†ç¡®æ€§** | é«˜ (æœ‰è¾¹æ¡†æ—¶) | ä¸­-é«˜ (å–å†³äºå¯¹é½) |

---

## ğŸ’¡ å‚æ•°è®¾å®šæœ€ä½³å®è·µ

### 1. Latticeæ¨¡å¼å‚æ•°è®¾å®šç­–ç•¥

```python
# åŸºäºå›¾åƒå’ŒPDFç‰¹å¾çš„è‡ªé€‚åº”å‚æ•°
def get_lattice_params(pdf_page, image_shape):
    params = {'flavor': 'lattice'}
    
    # 1. line_scale: åŸºäºå›¾åƒå°ºå¯¸
    if image_shape:
        params['line_scale'] = min(40, max(15, int(min(image_shape) * 0.01)))
    else:
        params['line_scale'] = 15
    
    # 2. line_tol: åŸºäºå­—ç¬¦å°ºå¯¸
    avg_char_width = calculate_avg_char_width(pdf_page)
    params['line_tol'] = max(1, avg_char_width * 0.4)
    params['line_tol'] = max(1, min(params['line_tol'], 5))
    
    # 3. joint_tol: ä¸line_tolä¿æŒä¸€è‡´
    params['joint_tol'] = params['line_tol']
    
    # 4. æ ¹æ®PDFè´¨é‡è°ƒæ•´threshold
    if is_scanned_pdf(pdf_page):
        params['threshold_blocksize'] = 21
        params['threshold_constant'] = 0  # é™ä½é˜ˆå€¼
    else:
        params['threshold_blocksize'] = 15
        params['threshold_constant'] = -2
    
    return params
```

### 2. Streamæ¨¡å¼å‚æ•°è®¾å®šç­–ç•¥

```python
# åŸºäºæ–‡æœ¬ç‰¹å¾çš„è‡ªé€‚åº”å‚æ•°
def get_stream_params(pdf_page):
    params = {'flavor': 'stream'}
    
    # 1. edge_tol: åŸºäºè¡Œé—´è·å’Œè¡Œé«˜
    line_gap = calculate_avg_line_gap(pdf_page)
    line_height = calculate_avg_line_height(pdf_page)
    params['edge_tol'] = line_gap * 3 + line_height * 2
    params['edge_tol'] = max(20, min(params['edge_tol'], 800))
    
    # 2. row_tol: åŸºäºè¡Œé«˜
    params['row_tol'] = line_height * 0.15
    params['row_tol'] = max(1, min(params['row_tol'], 10))
    
    # 3. column_tol: åŸºäºå•è¯é—´è·
    word_gap = calculate_avg_word_gap(pdf_page)
    char_width = calculate_avg_char_width(pdf_page)
    params['column_tol'] = min(word_gap * 0.5, char_width * 1.5)
    params['column_tol'] = max(0, min(params['column_tol'], 5))
    
    return params
```

### 3. æ¨¡å¼é€‰æ‹©ç­–ç•¥

```python
def choose_mode(pdf_page):
    """
    æ ¹æ®PDFé¡µé¢ç‰¹å¾é€‰æ‹©æ¨¡å¼
    """
    # æ£€æµ‹çº¿æ¡æ•°é‡
    h_lines = len([l for l in pdf_page.lines if is_horizontal(l)])
    v_lines = len([l for l in pdf_page.lines if is_vertical(l)])
    
    # ç­–ç•¥1: åŸºäºçº¿æ¡æ•°é‡
    if v_lines >= 5 and h_lines >= 5:
        return 'lattice'  # å……è¶³çš„çº¿æ¡ â†’ Lattice
    
    # ç­–ç•¥2: åŸºäºçº¿æ¡å¯†åº¦
    page_area = pdf_page.width * pdf_page.height
    line_density = (h_lines + v_lines) / page_area
    
    if line_density > 0.001:  # çº¿æ¡å¯†åº¦é«˜
        return 'lattice'
    else:
        return 'stream'  # çº¿æ¡ç¨€ç–æˆ–æ— çº¿æ¡ â†’ Stream
```

---

## âš ï¸ å¸¸è§é™·é˜±ä¸æ³¨æ„äº‹é¡¹

### Latticeæ¨¡å¼

1. **line_scaleè¿‡å¤§å¯¼è‡´æ–‡æœ¬è¢«æ£€æµ‹ä¸ºçº¿æ¡**
   - ç°è±¡ï¼šè¡¨æ ¼æ— æ³•è¯†åˆ«ï¼Œæˆ–è¯¯æ£€æµ‹
   - è§£å†³ï¼šé™ä½line_scaleåˆ°15-25

2. **æ‰«æPDFé˜ˆå€¼è®¾ç½®ä¸å½“**
   - ç°è±¡ï¼šçº¿æ¡æ£€æµ‹ä¸åˆ°æˆ–å™ªç‚¹è¿‡å¤š
   - è§£å†³ï¼šè°ƒæ•´threshold_constantï¼Œæ‰«æPDFä½¿ç”¨-1~2

3. **line_tolå’Œjoint_tolä¸ä¸€è‡´**
   - ç°è±¡ï¼šæœ‰äº›å•å…ƒæ ¼è¾¹ç¼˜è¯†åˆ«å¼‚å¸¸
   - è§£å†³ï¼šä¿æŒä¸¤è€…ä¸€è‡´æˆ–joint_tolç•¥å¤§

### Streamæ¨¡å¼

1. **edge_tolè¿‡å°å¯¼è‡´åˆ—æ–­è£‚**
   - ç°è±¡ï¼šæ— æ³•è¯†åˆ«è¡¨æ ¼æˆ–åˆ—æ•°é”™è¯¯
   - è§£å†³ï¼šå¢å¤§edge_tolåˆ°è¡Œé—´è·çš„2-5å€

2. **row_tolè¿‡å¤§å¯¼è‡´è¡Œåˆå¹¶**
   - ç°è±¡ï¼šå¤šè¡Œè¢«åˆå¹¶ä¸ºä¸€è¡Œ
   - è§£å†³ï¼šé™ä½row_tolåˆ°è¡Œé«˜çš„10-20%

3. **column_tolè¿‡å¤§å¯¼è‡´åˆ—åˆå¹¶**
   - ç°è±¡ï¼šå¤šåˆ—è¢«åˆå¹¶ä¸ºä¸€åˆ—
   - è§£å†³ï¼šé™ä½column_tolï¼Œç”šè‡³è®¾ä¸º0

---

## ğŸ”¬ å‚æ•°è°ƒè¯•å»ºè®®

### Latticeæ¨¡å¼è°ƒè¯•

```python
import camelot

# 1. æµ‹è¯•ä¸åŒline_scale
for line_scale in [15, 25, 40]:
    tables = camelot.read_pdf(
        'test.pdf',
        flavor='lattice',
        line_scale=line_scale,
        pages='1'
    )
    print(f"line_scale={line_scale}: {len(tables)} tables found")

# 2. å¯è§†åŒ–æ£€æµ‹åˆ°çš„çº¿æ¡
tables = camelot.read_pdf('test.pdf', flavor='lattice')
camelot.plot(tables[0], kind='contour').show()  # æ˜¾ç¤ºè½®å»“
camelot.plot(tables[0], kind='grid').show()     # æ˜¾ç¤ºç½‘æ ¼
```

### Streamæ¨¡å¼è°ƒè¯•

```python
# 1. æµ‹è¯•ä¸åŒedge_tol
for edge_tol in [30, 50, 100]:
    tables = camelot.read_pdf(
        'test.pdf',
        flavor='stream',
        edge_tol=edge_tol,
        pages='1'
    )
    print(f"edge_tol={edge_tol}: {len(tables)} tables found")

# 2. å¯è§†åŒ–æ–‡æœ¬è¾¹ç¼˜
tables = camelot.read_pdf('test.pdf', flavor='stream')
camelot.plot(tables[0], kind='textedge').show()  # æ˜¾ç¤ºæ–‡æœ¬è¾¹ç¼˜
```

---

## ğŸ“š å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£
- **Camelot GitHub**: https://github.com/camelot-dev/camelot
- **å®˜æ–¹æ–‡æ¡£**: https://camelot-py.readthedocs.io/
- **æºä»£ç **: 
  - `parsers/lattice.py`
  - `parsers/stream.py`
  - `core.py`

### ç›¸å…³ç®—æ³•è®ºæ–‡
- **Nurminen's Algorithm**: Anssi Nurminen's Master's Thesis
  - Link: https://dspace.cc.tut.fi/dpub/bitstream/handle/123456789/21520/Nurminen.pdf

### å·¥å…·èµ„æº
- **å¯è§†åŒ–å·¥å…·**: `camelot.plot()`
- **å‘½ä»¤è¡Œå·¥å…·**: `camelot --help`

---

**æ–‡æ¡£ç»´æŠ¤**:
- ç‰ˆæœ¬: v1.0
- åˆ›å»º: 2025-10-30
- ä½œè€…: AIç¼–ç¨‹åŠ©æ‰‹
- åŸºäº: Camelotæºä»£ç åˆ†æ

**æ³¨**: æœ¬æ–‡æ¡£ä¸“æ³¨äºCamelotå®˜æ–¹æœºåˆ¶è¯´æ˜ï¼Œä¸åŒ…å«å…·ä½“å·¥ç¨‹å®ç°ã€‚

